class t{constructor(){this.start_value=void 0}parse(t){return t}verify(t,e){e.valid=!0}filter(){return!0}string(t){return t+""}}class e extends t{constructor(){super(),this.start_value=0}parse(t){return parseFloat(t)}verify(t,e){e.valid=!0,NaN!=t&&null!=t||(e.valid=!1,e.reason="Invalid number type.")}filter(t,e){for(let s=0,i=e.length;s<i;s++)if(t==e[s])return!0;return!1}}let s=new e;var i={type:"",text:""};class n{constructor(t){for(this.tk=t,this.token=t.next(),this.hold=null;this.token&&("new_line"===this.token.type||"white_space"===this.token.type||"generic"===this.token.type);)this.token=this.tk.next()}reset(){this.tk.reset(),this.token=this.tk.next(),this.hold=null}next(){if(null!==this.hold)return this.token=this.hold,this.hold=null,this.token;if(!this.token)return null;do{this.token=this.tk.next()}while(this.token&&("new_line"===this.token.type||"white_space"===this.token.type||"generic"===this.token.type));return this.token?this.token:null}assert(t){if(!this.token)throw new Error(`Expecting ${t} got null`);var e=this.token.text==t;if(!e)throw new Error(`Expecting "${t}" got "${this.token.text}"`);return this.next(),e}peek(){if(this.hold)return this.hold;if(this.hold=this.tk.next(),!this.hold)return i;for(;this.hold&&("new_line"===this.hold.type||"white_space"===this.hold.type||"generic"===this.hold.type);)this.hold=this.tk.next();return this.hold?this.hold:i}get text(){return this.token?this.token.text:null}get type(){return this.token?this.token.type:""}get pos(){return this.token?this.token.pos:-1}slice(t){return this.token?this.tk.string.slice(t,this.token.pos):this.tk.string.slice(t)}}function r(t){for(var e=arguments,s=1,i=e.length;s<i;s++)if(e[s]===t)return!0;return!1}function h(t){return t>arguments[1]&&t<arguments[2]}var o=function(){var t=[{type:"number",check:(t,e,s)=>h(t,47,58)?r(t=e.charCodeAt(1+s),66,98,88,120,79,111)?2:1:46==t&&h(t=e.charCodeAt(1+s),47,58)?2:0,scanToEnd:t=>h(t,47,58)||46===t?-1:0,format(t){t.color="rgb(20,40,180)"}},{type:"identifier",check:t=>h(t,64,91)||h(t,96,123)?1:0,scanToEnd:t=>h(t,47,58)||h(t,64,91)||h(t,96,123)||r(t,35,36,45,95)?-1:0,format(t){}},{type:"string",check:(t,e)=>34===t?1:0,scanToEnd:t=>34===t?1:-1,format(t){}},{type:"white_space",check:t=>32===t||9===t?1:0,scanToEnd:t=>32===t||9===t?-1:0,format(t){}},{type:"new_line",check:t=>10===t?1:0,scanToEnd:t=>0,format(t){}},{type:"open_bracket",check:t=>r(t,123,40,91)?1:0,scanToEnd:t=>0,format(t){t.color="rgb(100,100,100)"}},{type:"close_bracket",check:t=>r(t,125,41,93)?1:0,scanToEnd:t=>0,format(t){t.color="rgb(100,100,100)"}},{type:"Operator",check:t=>r(t,42,43,60,61,62,92,38,37,33,94,124,58)?1:0,scanToEnd:t=>0,format(t){t.color="rgb(205,120,0)"}},{type:"Symbol",check:t=>1,scanToEnd:t=>0,format(t){t.color="red"}}];return t.clone=function(){return o()},t},l=o(),a=l.length;class u{constructor(t){this.h=null,this.line=0,this.char=0,this.offset=0,this.string=t}reset(){this.line=0,this.char=0,this.offset=0}hold(t){this.h=t}next(){var t=0;if(this.h){var e=this.h;return this.h=null,e}if(this.string.length<1)return null;let s=this.offset;if(s>=this.string.length)return null;var i=this.string.charCodeAt(s);let n;for(var r=0;r<a;r++){let e=(n=l[r]).check(i,this.string,s);if(e>0){this.type=n.type;var h=0;for(r=e;r<this.string.length&&!((h=n.scanToEnd(this.string.charCodeAt(r+s)))>-1);r++)h=0;t=r+h;break}}var o=this.string.slice(s,s+t);"new_line"===n.type&&(this.char=0,this.line++);var u={type:n.type,text:o,pos:this.offset,length:t,char:this.char,line:this.line};return this.offset+=t,this.char+=t,u}}class c extends Float64Array{constructor(t,e){if(super(2),"number"==typeof t)return this[0]=t,void(this[1]=e);t instanceof Array&&(this[0]=t[0],this[1]=t[1])}draw(t,e=1){t.beginPath(),t.moveTo(this.x*e,this.y*e),t.arc(this.x*e,this.y*e,.01*e,0,2*Math.PI),t.stroke()}get x(){return this[0]}set x(t){"number"==typeof t&&(this[0]=t)}get y(){return this[1]}set y(t){"number"==typeof t&&(this[1]=t)}}function d(t,e,s,i){var n=1-t;return n*n*e+2*n*t*s+t*t*i}function p(t,e,s){var i={a:1/0,b:1/0},n=t-2*e+s,r=2*(e-t),h=t;return 0==r||(Math.abs(n)<5e-11?i.a=-h/r:(i.a=(-r-Math.sqrt(r*r-4*n*h))/(2*n),i.b=(-r+Math.sqrt(r*r-4*n*h))/(2*n))),i}class _{constructor(t,e,s,i,n,r){return this.x1=0,this.x2=0,this.x3=0,this.y1=0,this.y2=0,this.y3=0,"number"==typeof t?(this.x1=t,this.x2=s,this.x3=n,this.y1=e,this.y2=i,void(this.y3=r)):t instanceof _?(this.x1=t.x1,this.x2=t.x2,this.x3=t.x3,this.y1=t.y1,this.y2=t.y2,void(this.y3=t.y3)):t instanceof Array?(this.x1=t[0],this.y1=t[1],this.x2=t[2],this.y2=t[3],this.x3=t[4],void(this.y3=t[5])):void 0}reverse(){return new _(this.x3,this.y3,this.x2,this.y2,this.x1,this.y1)}point(t){return new c(d(t,this.x1,this.x2,this.x3),d(t,this.y1,this.y2,this.y3))}tangent(t){var e={x:0,y:0},s=this.x2-this.x1,i=this.y2-this.y1,n=this.x3-this.x2,r=this.y3-this.y2;return e.x=(1-t)*s+t*n,e.y=(1-t)*i+t*r,e}toArray(){return[this.x1,this.y1,this.x2,this.y2,this.x3,this.y3]}split(t){return function(t,e){var s=[],i=[];return function t(e,n){if(2==e.length)s.push(e[0],e[1]),i.push(e[0],e[1]);else{for(var r=[],h=0;h<e.length-2;h+=2)0==h&&s.push(e[h],e[h+1]),h==e.length-4&&i.push(e[h+2],e[h+3]),r.push((1-n)*e[h]+n*e[h+2]),r.push((1-n)*e[h+1]+n*e[h+3]);t(r,n)}}(t,e),{x:new _(i),y:new _(s)}}(this.toArray(),t)}rootsX(){return this.roots(this.x1,this.x2,this.x3)}roots(t,e,s){this.toArray();var i=t-2*e+s,n=2*(e-t),r=t,h=2*r;console.log(i," c");var o=Math.sqrt(n*n-4*r*i);return console.log(o,n,h,s),[(-n+o)/h,(-n-o)/h]}rootsa(){var t=this.toArray(),e=t[1],s=t[3],i=t[5],n=t[0],r=t[2],h=2*(s-e),o=2*(r-n);return[-h/(-h+2*(i-s)),-o/(-o+2*(t[4]-r))]}boundingBox(){var t=curve[0],e=curve[1],s=curve[2],i=curve[3],n=curve[4],r=curve[5],h=getRootsClamped(curve);return{min:{x:Math.min(t,s,n,h.y[0]||1/0,h.x[0]||1/0),y:Math.min(e,i,r,h.y[1]||1/0,h.x[1]||1/0)},max:{x:Math.max(t,s,n,h.y[0]||-1/0,h.x[0]||-1/0),y:Math.max(e,i,r,h.y[1]||-1/0,h.x[1]||-1/0)}}}rotate(t,e){t=t/180*Math.PI;for(var s=this.toArray(),i=0;i<6;i+=2){var n=curve[i]-e.x,r=curve[i+1]-e.y;s[i]=n*Math.cos(t)-r*Math.sin(t)+e.x,s[i+1]=n*Math.sin(t)+r*Math.cos(t)+e.y}return new _(s)}intersects(){return{x:p(this.x1,this.x2,this.x3),y:p(this.y1,this.y2,this.y3)}}add(t,e){if("number"==typeof t)return new _(this.x1+t,this.y1+e,this.x2+t,this.y2+e,this.x3+t,this.y3+e)}}const f=Math.sqrt,m=Math.cos,g=Math.acos,w=Math.PI;function y(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function v(t,e,s,i,n){var r=1-t,h=r*r,o=t*t;return r*h*e+3*h*t*s+3*o*r*i+o*t*n}class x extends Float64Array{constructor(t,e,s,i,n,r,h,o){return super(8),4==arguments.length?(this[0]=0,this[1]=0,this[2]=t,this[3]=e,this[4]=s,this[5]=i,this[6]=1,void(this[7]=1)):"number"==typeof t?(this[0]=t,this[1]=e,this[2]=s,this[3]=i,this[4]=n,this[5]=r,this[6]=h,void(this[7]=o)):t instanceof Array?(this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],void(this[7]=t[4])):void 0}get x1(){return this[0]}set x1(t){this[0]=t}get x2(){return this[2]}set x2(t){this[2]=t}get x3(){return this[4]}set x3(t){this[4]=t}get x4(){return this[6]}set x4(t){this[6]=t}get y1(){return this[1]}set y1(t){this[1]=t}get y2(){return this[3]}set y2(t){this[3]=t}get y3(){return this[5]}set y3(t){this[5]=t}get y4(){return this[7]}set y4(t){this[7]=t}add(t,e=0){return new CCurve(this[0]+t,this[1]+e,this[2]+t,this[3]+e,this[4]+t,this[5]+e,this[6]+t,this[7]+e)}valY(t){return v(t,this[1],this[3],this[5],this[7])}valX(t){return v(t,this[0],this[2],this[4],this[6])}point(t){return new c(v(t,this[0],this[2],this[4],this[6]),v(t,this[1],this[3],this[5],this[7]))}roots(t,e,s,i){var n,r,h,o=3*e-t-3*s+i,l=(3*t-6*e+3*s)/o,a=(-3*t+3*e)/o,u=(3*a-l*l)/3,c=(2*l*l*l-9*l*a+27*(t/o))/27,d=c/2,p=d*d+(s=u/3)*s*s;if(p<0){var _=-u/3,v=f(_*_*_),x=-c/(2*v),k=g(x<-1?-1:x>1?1:x),b=2*y(v);return r=b*m(k/3)-l/3,h=b*m((k+2*w)/3)-l/3,[b*m((k+4*w)/3)-l/3,r,h]}if(0===p)return[h=-(n=d<0?y(-d):-y(d))-l/3,r=2*n-l/3];var E=f(p);return[r=(n=y(E-d))-y(E+d)-l/3]}rootsY(){return this.roots(this[1],this[3],this[5],this[7])}rootsX(){return this.roots(this[0],this[2],this[4],this[6])}getYatX(t){var e,s=this[0]-t,i=this[2]-t,n=3*i,r=3*s,h=3*(this[4]-t),o=1/(-s+n-h+(this[6]-t)),l=(r-6*i+h)*o,a=(-r+n)*o,u=1/3*(3*a-l*l),c=u*(1/3),d=1/27*(2*l*l*l-9*l*a+27*(s*o)),p=.5*d,_=p*p+c*c*c;if(_<0){var x=-u/3,k=f(x*x*x),b=-d/(2*k),E=g(b<-1?-1:b>1?1:b);e=2*y(k)*m((E+4*w)/3)-l/3}else if(0===_)e=-(p<0?y(-p):-y(p))-l*(1/3);else{var T=f(_);e=y(T-p)-y(T+p)-l*(1/3)}return v(e,this[1],this[3],this[5],this[7])}draw(t,e=1){t.beginPath(),t.moveTo(this[0]*e,this[1]*e),t.bezierCurveTo(this[2]*e,this[3]*e,this[4]*e,this[5]*e,this[6]*e,this[7]*e),t.stroke()}}function k(t){var e="";if(arguments.length>1){for(var s=0;s<arguments.length;s++)if((t=arguments[s]).component){var i=`${t.component}&`;for(var n in t)i+="component"!=n?`${n}=${t[n]}&`:"";e+=i.slice(0,-1)+"."}}else for(var n in t)e+=`${n}=${t[n]}&`;return e.slice(0,-1)}function b(t){return"string"!=typeof t?(console.warn("Cannot create a lexer on a non-string object!"),null):new n(new u(t))}Element.prototype.getWindowTop=function(){return this.offsetTop+(this.parentElement?this.parentElement.getWindowTop():0)},Element.prototype.getWindowLeft=function(){return this.offsetLeft+(this.parentElement?this.parentElement.getWindowLeft():0)},Element.prototype.getParentWindowTop=function(t=!1){return(t?this.offsetTop:0)+(this.parentElement?this.parentElement.getParentWindowTop(!0):0)},Element.prototype.getParentWindowLeft=function(t=!1){return(t?this.offsetLeft:0)+(this.parentElement?this.parentElement.getWindowLeft(!0):0)},Element.prototype.getStyle=function(t){return window.getComputedStyle(this,null).getPropertyValue(t)};var E=Object.freeze({Lex:b,Lexer:n,Tokenizer:u,months:[{name:"January",days:31,day_offset:0,day_offse_leapt:0},{name:"February",days:28,day_offset:31,day_offset_leap:31},{name:"March",days:31,day_offset:59,day_offset_leap:60},{name:"April",days:30,day_offset:90,day_offset_leap:91},{name:"May",days:31,day_offset:120,day_offset_leap:121},{name:"June",days:30,day_offset:151,day_offset_leap:152},{name:"July",days:31,day_offset:181,day_offset_leap:182},{name:"August",days:31,day_offset:212,day_offset_leap:213},{name:"September",days:30,day_offset:243,day_offset_leap:244},{name:"October",days:31,day_offset:273,day_offset_leap:274},{name:"November",days:30,day_offset:304,day_offset_leap:305},{name:"December",days:31,day_offset:33,day_offse_leapt:335}],dow:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],QBezier:_,CBezier:x,TurnQueryIntoData:function(t){var e={};let s=t.split(".");return s.length>0?s.forEach(t=>{var s={};t.length>1&&t.split("&").forEach((t,i)=>{if(i<1)e[t]=s;else{let s=t.split("=");e[s[0]]=s[1]}})}):t.split("&").forEach(t=>{let s=t.split("=");e[s[0]]=s[1]}),e},TurnDataIntoQuery:k,GetDayStartAndEnd:function(t){var e={start:0,end:0};if(t instanceof Date||"number"==typeof t){var s=new Date(t);s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0),e.start=s.valueOf(),s.setDate(s.getDate()+1),s.setSeconds(-1),e.end=s.valueOf()}return e},TouchScroller:class{constructor(t,e=.02,s=0){this.origin_x=0,this.origin_y=0,this.velocity_x=0,this.velocity_y=0,this.GO=!0,this.drag=e>0?e:.02,this.ele=t,!s instanceof Number&&(s=0);let i=0,n=(t,e,s,i=1)=>{let r=this.drag;t-=t*r*s*i,e-=e*r*s*i;let h=Math.max(Math.abs(e),Math.abs(e)),o=!(s>0&&h>.1&&this.GO);o||requestAnimationFrame(()=>{n(t,e,1)}),o=o&&0!=s;for(var l=0,a=this.listeners.length;l<a;l++)this.listeners[l]({dx:t,dy:e,end:o})&&(this.GO=!1)};this.event_b=(t=>{i=performance.now();var e=t.touches[s];this.velocity_x=this.origin_x-e.clientX,this.velocity_y=this.origin_y-e.clientY,this.origin_x=e.clientX,this.origin_y=e.clientY,n(this.velocity_x,this.velocity_y,0,0)}),this.event_c=(t=>{let e=performance.now()-i,s=Math.min(e/8.6666666,1/this.drag);this.GO=!0,n(this.velocity_x,this.velocity_y,s),this.velocity_x=0,this.velocity_y=0,window.removeEventListener("touchmove",this.event_b),window.removeEventListener("touchend",this.event_c)}),this.event_a=(t=>{if(!this.GO)return t.preventDefualt(),t.stopPropagation(),!1;i=performance.now(),this.GO=!1;var e=t.touches[s];e&&(this.origin_y=e.clientY,this.origin_x=e.clientX,window.addEventListener("touchmove",this.event_b),window.addEventListener("touchend",this.event_c))}),this.ele.addEventListener("touchstart",this.event_a),this.listeners=[]}destructor(){this.listeners=null,this.ele.removeEventListener("touchstart",this.event_a)}addEventListener(t){if(t instanceof Function){for(var e=0;e<this.listeners.length;e++)if(this.listeners[e]==t)return;this.listeners.push(t)}}removeEventListener(t){for(var e=0;e<this.listeners.length;e++)if(this.listeners[e]==t)return void this.listeners.splice(e,1)}},float24to12ModTime:function(t,e){var s=t>=12&&t<24;return((0|t)%12!=0?(0|t)%12:12)+":"+("0"+(t%1*60|0)).slice(-2)+(s?e?"PM":"pm":e?"AM":"am")}});let T=new Date;T.setHours(0),T.setMilliseconds(0),T.setSeconds(0),T.setTime(0);class S extends e{parse(t){if(!isNaN(t))return parseInt(t);let e=b(t),s=parseInt(e.token.text);if(s){T.setHours(0),T.setMilliseconds(0),T.setSeconds(0),T.setTime(0),e.next(),e.next();let t=parseInt(e.token.text)-1;e.next(),e.next();let i=parseInt(e.token.text);if(T.setFullYear(s),T.setDate(i),T.setMonth(t),e.next(),e.token){let t=parseInt(e.token.text);e.next(),e.next();let s=parseInt(e.token.text);T.setHours(t),T.setMinutes(s)}return T.valueOf()}return new Date(t).valueOf()}verify(t,e){this.parse(t),super.verify(t,e)}filter(t,e){if(e.length>1)for(let s=0,i=e.length-1;s<i;s+=2){let i=e[s],n=e[s+1];if(i<=t&&t<=n)return!0}return!1}string(t){return new Date(t)+""}}let C=new S;class M extends e{parse(t){if(!isNaN(t))return parseInt(t);try{var e=parseInt(t.split(":")[0]),s=parseInt(t.split(":")[1].split(" ")[0]),i="pm"==t.split(":")[1].split(" ")[1].toLowerSource()}catch(t){e=0,s=0,i=0}return parseFloat(e+(i?12:0)+s/60)}verify(t,e){this.parse(t),super.verify(t,e)}filter(t,e){return!0}string(t){return new Date(t)+""}}let A=new M;class O extends t{constructor(){super(),this.start_value=""}parse(t){return t+""}verify(t,e){e.valid=!0}filter(t,e){for(let s=0,i=e.length;s<i;s++)if(t.match(e[s]+""))return!0;return!1}}class L extends t{constructor(){super(),this.start_value=!1}parse(t){return!!t}verify(t,e){e.valid=!0,!t instanceof Boolean&&(e.valid=!1,e.reason=" Value is not a Boolean.")}filter(t,e){return value instanceof Boolean}}let I={date:C,string:new O,number:s,bool:new L,time:A};class D{constructor(){this.next=null,this.model=null}destructor(){this.model&&this.model.removeView(this)}update(t){}removed(t){}added(t){}setModel(t){}reset(){}unsetModel(){this.next=null,this.model=null}}const N=window&&window.requestAnimationFrame?window.requestAnimationFrame:t=>{setTimeout(t,1)},P=new class{constructor(){this.update_queue_a=new Array,this.update_queue_b=new Array,this.update_queue=this.update_queue_a,this.queue_switch=0,this.callback=(()=>this.update()),this.frame_time=performance.now(),this.____SCHEDULED____=!1}queueUpdate(t){if(t.____SCHEDULED____||!t.update instanceof Function)return this.____SCHEDULED____?void 0:N(this.callback);t.____SCHEDULED____=!0,this.update_queue.push(t),this.____SCHEDULED____||(this.____SCHEDULED____=!0,N(this.callback))}update(){this.____SCHEDULED____=!1;let t=this.update_queue;0==this.queue_switch?(this.update_queue=this.update_queue_b,this.queue_switch=1):(this.update_queue=this.update_queue_a,this.queue_switch=0);let e=performance.now(),s=e-this.frame_time;this.frame_time=e;let i=.06*s;for(let e=0,s=t.length,n=t[0];e<s;n=t[++e])n.____SCHEDULED____=!1,n.update(i);t.length=0}};class F{constructor(){this.____changed_values____=[]}destructor(){for(var t=this.first_view;t;)t.unsetModel(),t=t.next;this.____changed_values____=null}get(){return this}scheduleUpdate(t){this.first_view&&(this.____changed_values____.push(t),P.queueUpdate(this))}getChanged(t){for(let e=0,s=this.____changed_values____.length;e<s;e++)if(this.____changed_values____[e]==t)return this[t];return null}addView(t){if(!(t instanceof D))throw new Exception("Passed in view is not an instance of wick.View!");t.model&&t.model.removeView(t);for(var e=this.first_view;e;){if(t==e)return;e=e.next}t.model=this,t.next=this.first_view,this.first_view=t,t.setModel(this),t.update(this.get())}removeView(t){if(t instanceof D&&t.model==this)for(var e=this.first_view,s=null;e;){if(t==e)return s?s.next=t.next:this.first_view=t.next,t.next=null,t.model=null,void t.reset();s=e,e=e.next}}update(t){this.updateViews(this),this.____changed_values____.length=0}updateViews(){for(var t=this.first_view;t;)t.update(this,this.____changed_values____),t=t.next;this.____changed_values____.length=0}updateViewsRemoved(t){for(var e=this.first_view;e;)e.removed(t),e=e.next}updateViewsAdded(t){for(var e=this.first_view;e;)e.added(t),e=e.next}toJson(){return JSON.stringify(this,null,"\t")}}Object.defineProperty(F.prototype,"first_view",{writable:!0,configurable:!1,enumerable:!1}),Object.defineProperty(F.prototype,"____changed_values____",{writable:!0,configurable:!1,enumerable:!1}),Object.seal(F.prototype);class $ extends Array{constructor(){super()}push(t){t instanceof Array?t.forEach(t=>{this.push(t)}):super.push(t)}__setFilters__(){}getChanged(){}toJSON(){return this}toJson(){return JSON.stringify(this,null,"\t")}}let q=()=>{},U=[];class z extends F{constructor(e){return super(),this.source=null,this.first_link=null,this.next=null,this.prev=null,this.pin=q,this.__filters__=U,this.schema=e||this.constructor.schema||{},this.schema.parser&&this.schema.parser instanceof t?this.parser=this.schema.parser:this.parser=new t,this.id="",this.schema.identifier&&"string"==typeof this.schema.identifier&&(this.id=this.schema.identifier),this}destructor(){this.schema=null,this.__filters__=null,this.source&&this.source.__unlink__(this),super.destructor()}get length(){return 0}set length(t){}__defaultReturn__(t){if(t)return new $;let e=new this.constructor(this.schema);return this.__link__(e),e}push(t){return this.insert(t,!0)}get(t,e){let s=null,i=!0;if(t?e?s=e:(null===e&&(i=!1),this.source||(i=!1),(s=this.__defaultReturn__(i)).__setFilters__(t)):s=e||this.__defaultReturn__(i),t){let e=t;!t instanceof Array&&(e=[t]),e=e.map(t=>this.parser.parse(t)),this.__get__(e,s)}else this.__getAll__(s);return s}insert(t,e=!1){let s=this.first_view?[]:null,i=!1;if(!e&&this.source)return this.source.insert(t);if(t instanceof Array)for(var n=0;n<t.length;n++)this.__insertSub__(t[n],i,s)&&(i=!0);else t&&(i=this.__insertSub__(t,i,s));return s&&s.length>0&&this.updateViewsAdded(s),i}__insertSub__(t,e,s){let i=t;var n=this.__getIdentifier__(t);return null!=n&&(i instanceof this.schema.model||(i=i.____self____)||(i=new this.schema.model).add(t),(n=this.__getIdentifier__(i,this.__filters__))&&(e=this.__insert__(i,s,n),this.__linksInsert__(i))),e}remove(t,e=!1){let s=t;if(!e&&this.source)return t?this.source.remove(t):this.source.remove(this.__filters__);let i=[];return t?(!t instanceof Array&&(s=[t]),s=s.map(t=>this.parser.parse(t)),this.__remove__(s,i)):this.__removeAll__(),this.__linksRemove__(s),i}__unlink__(t){t instanceof z&&t.source==this&&(t==this.first_link&&(this.first_link=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t.source=null)}__link__(t){t instanceof z&&!t.source&&(t.source=this,t.next=this.first_link,this.first_link&&(this.first_link.prev=t),this.first_link=t,t.pin=(t=>{let e=setTimeout(()=>{t.__unlink__()},50);return()=>{clearTimeout(e),t.source||console.warn("failed to clear the destruction of container in time!")}})(t))}__linksRemove__(t){let e=this.first_link;for(;e;)e.remove(t,!0),e=e.next}__linksInsert__(t){let e=this.first_link;for(;e;)e.insert(t,!0),e=e.next}cull(t){let e=__getAll__([],!0),s=t=>{if(t instanceof Array)return t.forEach(t=>s(t));this.__getIdentifier__(t)};s(t);for(let t=0;t<e.lenth;t++){let s=e[t];e[this.__getIdentifier__(s)]||this.__remove__(s)}this.insert(t)}__setFilters__(t){t instanceof Array?this.__filters__=this.__filters__.concat(t.map(t=>this.parser.parse(t))):this.__filters__.push(this.parser.parse(t))}__filterIdentifier__(t,e){return!(e.length>0)||this.parser.filter(t,e)}__getIdentifier__(t,e=null){let s=null;return(s="object"==typeof t?t[this.schema.identifier]:t)&&(s=this.parser.parse(s)),e&&s?this.__filterIdentifier__(s,e)?s:void 0:s}__insert__(t,e,s){return!1}__get__(t,e){return e}__getAll__(t){return t}__removeAll__(){return[]}__remove__(t){return[]}}class H extends z{constructor(t){super({identifier:"indexed",model:t.model}),this.schema=t,this.indexes={},this.first_index=null,this.addIndex(t.index)}get length(){return this.first_index.length}addIndex(t){for(let e in t){let s=t[e];s.container&&!this.indexes[e]&&(this.indexes[e]=new s.container(s.schema),this.first_index?this.indexes[e].insert(this.first_index.__getAll__()):this.first_index=this.indexes[e])}}get(t,e){let s={};if(t)for(let i in t)this.indexes[i]&&(s[i]=this.indexes[i].get(t[i],e));else s=this.first_index.get(null);return s}remove(t){var e=[];for(let s in t)this.indexes[s]&&(e=e.concat(this.indexes[s].remove(t[s])));for(var s=0;s<this.indexes.length;s++)for(var i=0;i<e.length;i++)this.indexes[s].remove(e[i]);return e.length>0&&this.updateViewsRemoved(e),e}__insert__(t,e,s){let i=!1;for(let e in this.indexes){this.indexes[e].insert(t)&&(i=!0)}return i&&this.updateViews(this.first_index.get()),i}__remove__(t){let e=!1;for(let s in this.indexes){this.indexes[s].remove(t)&&(e=!0)}return e}__removeAll__(){let t=!1;for(let e in this.indexes)index.__removeAll__()&&(t=!0);return t}__getIdentifier__(t,e=null){return!0}toJSON(){return"[]"}}class R extends z{constructor(t){super(t),this.data=[]}destructor(){this.data=null,super.destructor()}get length(){return this.data.length}__defaultReturn__(){if(this.source)return new $;let t=new R(this.schema);return this.__link__(t),t}__insert__(t,e,s){for(var i=0,n=this.data.length;i<n;i++){var r=this.data[i];if(this.__getIdentifier__(r)==s)return r.add(t),!1}return this.data.push(t),e&&e.push(t),!0}__get__(t,e){let s=null;t&&(s=t instanceof Array?t:[t]);for(let t=0,i=this.data.length;t<i;t++){let i=this.data[t];this.__getIdentifier__(i,s)&&e.push(i)}return e}__getAll__(t){return this.data.forEach(e=>{t.push(e)}),t}__removeAll__(){let t=this.data.map(t=>t)||[];return this.data.length=0,t}__remove__(t,e){let s=!1;for(var i=0,n=this.data.length;i<n;i++){var r=this.data[i];this.__getIdentifier__(r,t)&&(s=!0,this.data.splice(i,1),n--,i--,e.push(r))}return s}toJSON(){return this.data}}Object.freeze(R);class j extends z{constructor(t){if(!(t&&t.parser&&t.parser instanceof e))throw new Error("BTreeModelContainer's MUST use a parser schema that is or inherits from NumberType schema and returns numerical values.");super(t),this.root=null,this.min=10,this.max=20,this.size=0}destructor(){this.root&&this.root.destructor(),super.destructor()}get length(){return this.size}__insert__(t,e,s){let i={added:!1};return this.root||(this.root=new V(!0)),this.root=this.root.insert(s,t,this.max,!0,i).newnode,e&&e.push(t),i.added&&this.size++,i.added}__get__(t,e){if(this.root&&t.length>0)if(1==t.length)this.root.get(parseFloat(t[0]),parseFloat(t[0]),e);else if(t.length<3)this.root.get(parseFloat(t[0]),parseFloat(t[1]),e);else for(let s=0,i=t.length-1;s>i;s+=2)this.root.get(parseFloat(t[s]),parseFloat(t[s+1]),e);return e}__remove__(t,e){let s=0;if(this.root&&t.length>0)if(1==t.length){let i=this.root.remove(t[0],t[0],!0,this.min,e);s=i.out,this.root=i.out_node}else if(t.length<3){let i=this.root.remove(t[0],t[1],!0,this.min,e);s=i.out,this.root=i.out_node}else for(let i=0,n=t.length-1;i>n;i+=2){let n=this.root.remove(t[i],t[i+1],!0,this.min,e);s=n.out,this.root=n.out_node}return this.size-=s,0!==s}__getAll__(t){return this.root&&this.root.get(-1/0,1/0,t),t}__removeAll__(){this.root&&this.root.destructor(),this.root=null}toJSON(){let t=[];return this.root&&this.root.get(-1/0,1/0,t),t}}class V{constructor(t=!1){this.LEAF=t,this.nodes=[],this.keys=[],this.items=0}destructor(){if(this.nodes=null,this.keys=null,!this.LEAF)for(let t=0,e=this.nodes.length;t<e;t++)this.nodes[t].destructor()}balanceInsert(t,e=!1){if(this.keys.length>=t){let s=new V(this.LEAF),i=t>>1|0,n=this.keys[i],r=this.keys.slice(0,i),h=this.nodes.slice(0,this.LEAF?i:i+1),o=this.keys.slice(this.LEAF?i:i+1),l=this.nodes.slice(this.LEAF?i:i+1);if(s.keys=o,s.nodes=l,this.keys=r,this.nodes=h,e){let t=new V;return t.keys.push(n),t.nodes.push(this,s),{newnode:t,key:n}}return{newnode:s,key:n}}return{newnode:this,key:0}}insert(t,e,s,i=!1,n){let r=this.keys.length;if(this.LEAF){for(let r=0,h=this.keys.length;r<h;r++){let h=this.keys[r];if(t==h)return this.nodes[r].add(h),n.added=!1,{newnode:this,key:t};if(t<h)return this.keys.splice(r,0,t),this.nodes.splice(r,0,e),n.added=!0,this.balanceInsert(s,i)}return this.keys.push(t),this.nodes.push(e),n.added=!0,this.balanceInsert(s,i)}{for(var h=0;h<r;h++){if(t<this.keys[h]){let r=this.nodes[h],o=r.insert(t,e,s,!1,n),l=o.key,a=o.newnode;return a!=r&&(this.keys.splice(h,0,l),this.nodes.splice(h+1,0,a)),this.balanceInsert(s,i)}}let o=this.nodes[h],{newnode:l,key:a}=o.insert(t,e,s,!1,n);return l!=o&&(this.keys.push(a),this.nodes.push(l)),this.balanceInsert(s,i)}}balanceRemove(t,e){let s=this.nodes[t-1],i=this.nodes[t+1],n=this.nodes[t];if(s&&s.keys.length>e){let e=s.keys.length,i=s.nodes.length;return n.keys.unshift(n.LEAF?s.keys[e-1]:this.keys[t-1]),n.nodes.unshift(s.nodes[i-1]),this.keys[t-1]=s.keys[e-1],s.keys.length=e-1,s.nodes.length=i-1,!1}if(i&&i.keys.length>e)return n.keys.push(n.LEAF?i.keys[0]:this.keys[t]),n.nodes.push(i.nodes[0]),i.keys.splice(0,1),i.nodes.splice(0,1),this.keys[t]=n.LEAF?i.keys[1]:i.keys[0],!1;{s||(t++,s=n,n=i);let e=this.keys[t-1];if(this.keys.splice(t-1,1),this.nodes.splice(t,1),s.nodes=s.nodes.concat(n.nodes),s.LEAF||s.keys.push(e),s.keys=s.keys.concat(n.keys),s.LEAF)for(let t=0;t<s.keys.length;t++)s.keys[t],s.nodes[t].id;return!0}}remove(t,e,s=!1,i,n){let r=this.keys.length,h=0,o=this;if(this.LEAF)for(let s=0,i=this.keys.length;s<i;s++){let r=this.keys[s];r<=e&&r>=t&&(n.push(this.nodes[s]),h++,this.keys.splice(s,1),this.nodes.splice(s,1),i--,s--)}else{for(var l=0;l<r;l++){t<=this.keys[l]&&(h+=this.nodes[l].remove(t,e,!1,i,n).out)}h+=this.nodes[l].remove(t,e,!1,i,n).out;for(l=0;l<this.nodes.length;l++)this.nodes[l].keys.length<i&&this.balanceRemove(l,i)&&(r--,l--);1==this.nodes.length&&(o=this.nodes[0])}return{out_node:o,out:h}}get(t,e,s){if(!t||!e)return!1;if(this.LEAF)for(let i=0,n=this.keys.length;i<n;i++){let n=this.keys[i];n<=e&&n>=t&&s.push(this.nodes[i])}else{for(var i=0,n=this.keys.length;i<n;i++){t<=this.keys[i]&&this.nodes[i].get(t,e,s)}this.nodes[i].get(t,e,s)}}}function B(t,e,s){if(t.prototype[s])return;let i=`__${s}__`;Object.defineProperty(t.prototype,i,{writable:!0,configurable:!1,enumerable:!1,value:e.start_value||void 0}),Object.defineProperty(t.prototype,s,{configurable:!1,enumerable:!0,get:function(){return this[i]},set:function(t){let n={valid:!1},r=e.parse(t);e.verify(r,n),n.valid&&this[i]!=r&&(this[i]=r,this.scheduleUpdate(s))}})}function G(t,e,s){e.schema;let i=e.container,n=`__${s}__`;Object.defineProperty(t.prototype,n,{enumerable:!1,writable:!0,value:null}),Object.defineProperty(t.prototype,s,{configurable:!1,enumerable:!0,get:function(){return this[n]||(this[n]=new i(e.schema)),this[n]},set:function(t){let r=this[n],h=null;if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return void console.log(t)}t instanceof Array?(h=t,r=new i(e.schema),this[n]=r,r.insert(h),this.scheduleUpdate(s)):t instanceof i&&(this[n]=t,console.log(s),this.scheduleUpdate(s))}})}function J(t,e,s){e.schema;Object.defineProperty(t.prototype,s,{configurable:!1,enumerable:!0,get:function(){return Object.defineProperty(this,s,{configurable:!1,enumerable:!0,writable:!1,value:new e}),this[s]},set:function(t){}})}Object.freeze(j);class W extends F{constructor(e){super();let s=this.constructor.schema;if(!s)return new X(e);{let i=s.__FinalConstructor__,n=this.constructor;if(Object.defineProperty(n.prototype,"schema",{writable:!1,enumerable:!1,configurable:!1,value:s}),!i){for(let e in s){let i=s[e];i instanceof Array?i[0]&&i[0].container&&i[0].schema?G(n,i[0],e):i[0]instanceof z&&J(n,i[0].constructor,e):i instanceof W?J(n,i[0].constructor,e):i instanceof t?B(n,i,e):console.warn(`Could not create property ${e}.`)}return Object.seal(n),Object.defineProperty(s,"__FinalConstructor__",{writable:!1,enumerable:!1,configurable:!1,value:n}),new n(e)}}e&&this.add(e)}destructor(){this.schema=null;for(let t in this){let e=this[t];"object"==typeof e&&e.destructor instanceof Function?e.destructor():this[t]=null}super.destructor()}verify(t){let e={valid:!0,reason:""};var s=this.schema[t];return s&&(s instanceof Array||s instanceof W||s.verify(this[t],e)),e}string(t){if(t){var e=this.schema[t];if(e)if(e instanceof Array)this[t].string();else{if(!(e instanceof W))return e.string(this[t]);this[t].string()}}}add(t){for(let e in t)e in this&&(this[e]=t[e])}get(t){var e={};if(!t)return this;for(var s in t)s in this&&(e[s]=this[s]);return e}toJSON(){let t={},e=this.schema;for(let s in e){e[s];t[s]=this[s]}return t}}function Y(t,e,s){return e in t&&t[e]==s||(t[e]=s,t.scheduleUpdate(e),!0)}class X extends F{constructor(t){if(super(),t)for(let e in t)this[e]=t[e];return new Proxy(this,{set:Y})}destroy(){this.destructor()}destructor(){super.destructor()}add(t){for(var e in t)this[e]=t[e]}get(t){var e={};if(!t)return this;for(var s in t){let t=this[s];t&&(e[s]=t)}return e}remove(t){return{}}toJSON(){let t={};for(let e in this)"first_view"!=e&&"changed_values"!=e&&"____SCHEDULED____"!=e&&(t[e]=this[e]);return t}toJsonString(){return this.data+""}}class Q{constructor(){}set(t,e){t.style.transition="opacity 0.5s",t.style.opacity=0}set_in(t,e,s=0){return t.style.transition=`opacity ${.8*s+.5}s`,t.style.opacity=1,.8}set_out(t,e,s=0){return t.style.opacity=0,.8}finalize_out(t){t.style.opacity=0}}let K={base:Q};class Z extends D{constructor(t=null,e={},s={}){super(),this.parent=t,this.ele=null,this.children=[],this.data=e,this.named_elements=null,this.active=!1,this.export_val=null,this.DESTROYED=!1,this.transitioneer=null,e.trs&&(s.transitions&&s.transitions[e.trs]?this.transitioneer=new s.transitions[e.trs]:K[e.trs]&&(this.transitioneer=new K[e.trs]),this.transitioneer.set(this.ele)),this.addToParent()}addToParent(){this.parent&&this.parent.children.push(this)}destructor(){if(this.DESTROYED=!0,this.LOADED){let t=this.transitionOut();for(let e=0,s=this.children.length;e<s;e++){let s=this.children[e];t=Math.max(t,s.transitionOut())}t>0&&setTimeout(()=>{this.destructor()},1e3*t+5)}else this.finalizeTransitionOut(),this.children.forEach(t=>t.destructor()),this.children.length=0,this.data=null,this.ele&&this.ele.parentElement&&this.ele.parentElement.removeChild(this.ele),this.ele=null,super.destructor()}bubbleLink(t,e,s={}){if(this.parent){this.data.transition&&(s[this.data.transition]=this.ele);for(var i=0,n=this.children.length;i<n;i++){let t=this.children[i];t!==e&&t.gatherTransitionElements(s)}this.parent.bubbleLink(t,this,s)}else history.pushState({},"ignored title",t),window.onpopstate()}getNamedElements(t){}gatherTransitionElements(t){this.data.transition&&!t[this.data.transition]&&(t[this.data.transition]=this.ele),this.children.forEach(e=>{1==e.is&&e.gatherTransitionElements(t)})}copy(t,e){let s={};if(t||(t=this.ele.cloneNode(!0)),this.children){s.ele=t.children[this.ele],s.children=new Array(this.children.length);for(var i=0,n=this.children.length;i<n;i++){let t=this.children[i];s.children[i]=t.copy(s.ele)}}return s}handleUrlUpdate(t){}finalizeTransitionOut(){for(let t=0,e=this.children.length;t<e;t++)this.children[t].finalizeTransitionOut();this.transitioneer&&this.transitioneer.finalize_out(this.ele),this.hide()}transitionIn(t=0){this.show();let e=0;this.LOADED=!0;for(let s=0,i=this.children.length;s<i;s++)e=Math.max(e,this.children[s].transitionIn(t));return this.transitioneer&&(e=Math.max(e,this.transitioneer.set_in(this.ele,this.data,t))),e}transitionOut(t=0,e=!1){let s=0;this.LOADED=!1,this.transitioneer&&(s=Math.max(s,this.transitioneer.set_out(this.ele,this.data,t)));for(let e=0,i=this.children.length;e<i;e++)s=Math.max(s,this.children[e].transitionOut(t));return e&&setTimeout(()=>{this.finalizeTransitionOut(),this.destructor()},1e3*s),s}updateDimensions(){for(var t=0;t<this.children.length;t++)this.children[t].updateDimensions()}__down__(t,e=null,s=!1){let i=this.down(t,e,s);i&&(t=i,s=!0);for(let i=0,n=this.children.length;i<n;i++)this.children[i].__down__(t,e,s)}down(t,e=null,s){}__up__(t){this.parent&&this.parent(up)}up(t){t&&this.__up__(t)}__update__(t,e=!1){let s=this.update(t,e);for(let e=0,i=this.children.length;e<i;e++)this.children[e].__update__(s||t,!0)}load(t){for(var e=0;e<this.children.length;e++)this.children[e].load(t)}hide(){this.ele&&(this.display=this.ele.style.display,this.ele.style.display="none")}show(){this.ele&&"none"==this.ele.style.display&&(this.ele.style.display=this.display)}__updateExports__(t){this.data.export&&t[this.data.export]&&(this.export_val=t[this.data.export])}__getExports__(t){this.export_val&&(t[this.data.export]=this.export_val)}export(t=new X){if(this.parent&&this.parent.export){this.__getExports__(t);for(let e=0,s=this.children.length;e<s;e++)this.children[e].__getExports__(t);this.parent.export(t)}}import(t){this.model&&this.model.add(t),this.export(t)}updateExports(t){this.data.export&&t[this.data.export]&&(this.export=t[this.data.export])}add(t){this.model?(this.model.add(t),this.export(this.model)):this.parent&&this.parent.add&&this.parent.add(t)}}class tt{constructor(t,e){this.url=t,this.FETCH_IN_PROGRESS=!1,this.rurl=e,this.model=null}destructor(){this.model=null}get(t,e,s=!0){this.FETCH_IN_PROGRESS=!0;var i=(s?"https://":"http://")+window.location.host+this.url+(t?"?"+this.__process_url__(t):"");return(t=>fetch(i,{credentials:"same-origin",method:"GET"}).then(e=>{this.FETCH_IN_PROGRESS=!1,e.json().then(e=>{this.__process_response__(e,t)})}).catch(e=>{this.FETCH_IN_PROGRESS=!1,this.__rejected_reponse__(t),console.warn(`Unable to process response for request made to: ${this.url}. Response: ${e}. Error Received: ${e}`)}))(e)}parseJson(t){return t}setModel(t){t instanceof Model&&(this.model=t)}set(t){this.model&&this.model.add(t)}__process_url__(t){var e="";for(var s in t)e+=`${s}=${t[s]}&`;return e.slice(0,-1)}__rejected_reponse__(t){t&&console.error("Unprocessed stored data in getter.")}__process_response__(t,e){if(this.rurl&&t){for(var s=this.rurl.split("<"),i=0;i<s.length&&t;i++)t=t[parseInt(s[i])?parseInt(s[i]):s[i]];console.log("json",t)}this.model?this.set(this.parseJson(t,e)):console.warn(`Unable to process response for request made to: ${this.url}. There is no model attached to this request controller!`)}}class et extends Z{constructor(t,e,s,i){super(t,e,s,i),this.prop=this.data.prop,this.width=0,this.height=0,this.top=0,this.left=0,this.lvl=0,this.is=1,this.data_cache=null,this.children=[],"A"==this.ele.tagName&&this.processLink(this.ele)}destructor(){"A"==this.ele.tagName&&this.destroyLink(this.ele),this.data_cache=null,super.destructor()}processLink(t,e){t.origin===location.origin&&(t.onclick||(t.onclick=((t,e,s)=>i=>{i.preventDefault(),s(t,e)&&i.preventDefault()})(t.href,t,(t,e)=>{let s=location.pathname==e.pathname,i=t.includes("#"),n="",r=b(t);for(;r.token;){if("{"==r.token.text){r.next();let e=r.token.text;r.next(),n+=this[e]||this.data_cache[e],"}"!=r.token.text&&console.warn(`incorrect value found in url ${t}`)}else n+=r.token.text;r.next()}return i&&this.export(),s||this.bubbleLink(n),!0})),t.onmouseover=(()=>{let e=t.href,s="",i=b(e);for(;i.token;){if("{"==i.token.text){i.next();let t=i.token.text;i.next(),s+=this[t]||this.data_cache[t],"}"!=i.token.text&&console.warn(`incorrect value found in url ${e}`)}else s+=i.token.text;i.next()}}))}destroyLink(t){t.onclick=null,t.onmouseover=null}update(t,e=!1){super.__updateExports__(t),t&&(this.prop?(this.ele.innerHTML=t[this.prop],this[this.prop]=t[this.prop]):this.data_cache=t)}import(t){}load(t){this.children.forEach(e=>{e.load(t)}),this.data.model&&t.addView(this)}updateDimensions(){var t=this.ele.getBoundingClientRect();this.width=t.width,this.height=t.height,this.top=t.top,this.left=t.left,super.updateDimensions()}}class st extends Z{constructor(t=null,e,s){super(t,e,s),this.USE_SECURE=s.USE_HTTPS,this.named_elements={},this.template=null,this.prop=null,this.url=null,this.presets=s,this.receiver=null,this.query={},this.REQUESTING=!1,this.exports=null,this.filter_list=[],this.templates=[],this.filters=[],this.is=0}destructor(){this.parent=null,this.receiver&&this.receiver.destructor();for(let t=0,e=this.templates.length;t<e;t++)this.templates[t].destructor();super.destructor()}load(t){if(this.data.url){let t=this.data.url.split(";");this.data.url=t[0];for(var e=1;e<t.length;e++){let s=t[e];switch(s[0]){case"p":this.url_parent_import=s.slice(1);break;case"q":this.url_query=s.slice(1);break;case"<":this.url_return=s.slice(1)}}}if(this.prop=this.data.prop,this.data.export&&(this.exports=this.data.export),this.model&&(t=this.model,this.model=null),t&&t instanceof W&&(this.schema&&(t.constructor!=this.schema||(this.schema=null)),this.model=null),this.schema&&(t=new this.schema),t.addView(this),!this.model)throw new Error(`No Model could be found for Source constructor! Source schema "${this.data.schema}", "${this.presets.schemas[this.data.schema]}"; Source model "${this.data.model}", "${this.presets.models[this.data.model]}";`);this.data.url&&(this.receiver=new tt(this.data.url,this.url_return),this.receiver.setModel(t),this.____request____());for(e=0;e<this.children.length;e++)this.children[e].load(this.model)}____request____(t){this.receiver.get(t,null,this.USE_SECURE).then(()=>{this.REQUESTING=!1}),this.REQUESTING=!0}export(t){this.updateSubs(this.children,t,!0),super.export(t)}updateSubs(t,e,s=!1){for(var i=0,n=t.length;i<n;i++){let n=t[i];if(n instanceof st)n.update(e,!0);else{let t;if(s){if(n.data.import&&e[n.data.import]&&(t=n.update(e,!0))){this.updateSubs(n.children,t);continue}}else t=n.update(e,!0);this.updateSubs(n.children,t||e,s)}}}up(t){this.model.add(t)}update(t,e){this.__down__(t,e)}handleUrlUpdate(t){let e=null;if(t&&this.data.import)if(e={},"null"==this.data.import)e=t.getClass(),console.log(e);else for(var s=this.data.import.split(";"),i=0;i<s.length;i++){let h=s[i].split(":"),o=h[0],l=h[1].split("=>");var n=l[0],r=l[1];"root"==o&&(o=null),e[r]=t.get(o,n)}if(t&&this.data.url){let e={};if(this.url_query)for(s=this.url_query.split(";"),i=0;i<s.length;i++){let h=s[i].split(":"),o=h[0],l=h[1].split("=>");n=l[0],r=l[1];"root"==o&&(o=null),e[r]=t.get(o,n)}this.____request____(e)}this.model||(this.model=new this.model_constructor,this.getter&&this.getter.setModel(this.model),this.model.addView(this)),e&&this.model.add(e)||this.update(this.model.get())}transitionIn(t=0){let e=0;for(let s=0,i=this.templates.length;s<i;s++)e=Math.max(e,this.templates[s].transitionIn(t));return e=Math.max(e,super.transitionIn(t)),this.updateDimensions(),e}transitionOut(t=0,e=!1){let s=0;for(let e=0,i=this.templates.length;e<i;e++)s=Math.max(s,this.templates[e].transitionOut(t));return s=Math.max(s,super.transitionOut(t,e))}finalizeTransitionOut(){for(let t=0,e=this.templates.length;t<e;t++)this.templates[t].finalizeTransitionOut();super.finalizeTransitionOut()}setActivating(){this.parent&&this.parent.setActivating()}getNamedElements(t){for(let e in this.named_elements)t[e]=this.named_elements[e]}}class it extends st{constructor(t=null,e,s){super(t,e,s),this.cases=[],this.activeSources=[],this.templates=[],this.filters=[],this.terms=[],this.range=null,this.prop_elements=[]}filterUpdate(){let t=this.cases.slice();for(let e=this.filters.length,s=0;s<e;s++)t=this.filters[s].filter(t);for(var e=0;e<this.activeSources.length;e++)this.ele.removeChild(this.activeSources[e].ele);for(e=0;e<t.length;e++)this.ele.appendChild(t[e].ele);this.ele.style.position=this.ele.style.position;for(e=0;e<t.length;e++)t[e].transitionIn(e);this.activeSources=t}cull(t){if(0==t.length){for(let t=0,e=this.cases.length;t<e;t++)this.cases[t].destructor();this.cases.length=0}else{let s=new Map(t.map(t=>[t,!0]));var e=[];for(let t=0,e=this.cases.length;t<e;t++)s.has(this.cases[t].model)?s.set(this.cases[t].model,!1):(this.cases[t].destructor(),this.cases.splice(t,1),e--,t--);s.forEach((t,s,i)=>{t&&e.push(s)}),e.length>0&&this.added(e)}}load(t){}removed(t){for(let e=0;e<t.length;e++){let s=t[e];for(let t=0;t<this.cases.length;t++){let e=this.cases[t];if(e.model==s){this.cases.splice(t,1),e.dissolve();break}}}this.filterUpdate()}added(t){for(let e=0;e<t.length;e++){let s=this.templates[0].flesh(t[e]);s.parent=this,this.cases.push(s)}this.filterUpdate()}revise(){this.cache&&this.update(this.cache)}getTerms(){let t=[];for(let e=0,s=this.terms.length;e<s;e++)t.push(this.terms[e].term);return 0==t.length?null:t}update(t,e=!1){console.log(t.toJson());let s=t.getChanged(this.prop);if(e){let e=!1;for(let s=0,i=this.terms.length;s<i;s++)this.terms[s].update(t)&&(e=!0);e&&this.model&&this.cull(this.get());for(let s=0,i=this.filters.length;s<i;s++)this.filters[s].update(t)&&(e=!0);e&&this.filterUpdate()}if(s&&(s instanceof z||s.____self____)){this.cache=t;let e=s.get(this.getTerms(),null);e instanceof z?(e.pin(),e.addView(this),this.cull(this.get())):e instanceof $?this.cull(e):(e=t.____self____.data[this.prop])instanceof z&&(e.addView(this),this.cull(this.get()))}}get(){if(!(this.model instanceof H)){let t=this.model.source,e=this.getTerms();if(t){this.model.destructor();let s=t.get(e,null);s.pin(),s.addView(this)}return this.model.get(e)}if(this.data.index){let t=this.data.index,e={};return e[t]=this.getTerms(),this.model.get(e)[t]}return console.warn("No index value provided for MultiIndexedContainer!"),[]}transitionIn(t,e){let s=0;for(let i=0,n=this.templates.length;i<n;i++)s=Math.max(s,this.templates[i].transitionIn(t,e));return Math.max(s,super.transitionIn()),s}transitionOut(t=0,e=!1){for(let e=0,s=this.templates.length;e<s;e++)t=Math.max(t,this.templates[e].transitionOut());return Math.max(t,super.transitionOut(t,e)),t}}class nt{constructor(t){this.lexer=new b(t.innerHTML),this.ele=t,this.stack=[],this.sp=0}get(t,e=!1){let s=this.lexer;for(e&&(s.reset(),this.stack.length=0,this.sp=0);;){if(!s.text)return e?null:this.get(t,!0);switch(s.text){case"<":if("/"==s.peek().text){if(s.next(),s.next(),s.next(),s.next(),--this.sp<0)return null;this.stack.length=this.sp+1,this.stack[this.sp]++}else{for(s.next(),s.next();">"!==s.text&&"/"!==s.text;)s.next(),"="==s.text&&(s.next(),s.next());if("/"==s.text){s.next(),s.next();break}if(s.next(),this.stack.push(0),this.sp++,"#"==s.text&&(s.next(),"#"==s.text&&(s.next(),":"==s.text&&(s.next(),"number"==s.type)))){if(parseInt(s.text)==t)return this.getElement()}}break;default:s.next()}}}getElement(){let t=this.ele;for(let e=0;e<this.sp;e++)t=t.children[this.stack[e]];return t}}class rt{constructor(t,e,s,i,n){this.ele=t,this.Constructor=e,this.children=[],this.templates=[],this.filters=[],this.terms=[],this.data=s,this.presets=i,this.index=n}flesh(t=null){let e=this.____copy____(null,null,null);return e.load(t),e}____copy____(t,e,s){let i,n,r=!1;if(this.index>0&&(i=s.get(this.index),r=!0),this.ele&&((t=this.ele.cloneNode(!0)).parentElement&&t.parentElement.replaceNode(t,i),s=new nt(t)),this.Constructor)n=new this.Constructor(e,this.data,this.presets),r&&(n.ele=i);else{if(!e)return(n=this.children[0].____copy____(t,null,s)).ele=t,n;n=e}if(this.children.length>0)for(var h=0,o=this.children.length;h<o;h++)this.children[h].____copy____(t,n,s);if(this.templates.length>0){if(this.terms.length>0)for(h=0,o=this.terms.length;h<o;h++)n.terms.push(this.terms[h].____copy____(t,null,s));if(this.filters.length>0)for(h=0,o=this.filters.length;h<o;h++)n.filters.push(this.filters[h].____copy____(t,null,s));for(h=0,o=this.templates.length;h<o;h++)n.templates.push(this.templates[h])}return n}}class ht extends et{constructor(t,e,s,i){super(t,e,s,i),this.ele.display="none",this.ele.addEventListener("input",()=>{var t={};t[this.prop]=this.ele.value,this.add(t)})}update(t){if(t[this.prop])switch(this.val=t[this.prop],this.ele.type){case"date":this.ele.value=new Date(parseInt(t[this.prop])).toISOString().split("T")[0];break;case"time":this.ele.value=`${("00"+(0|t[this.prop])).slice(-2)}:${("00"+t[this.prop]%1*60).slice(-2)}:00.000`;break;case"text":this.ele.value=null!=t[this.prop]?t[this.prop]:"";break;default:switch(this.ele.classList[0]){case"modulo_time":var e=t[this.prop],s=e/12>1,i=e%1*60|0,n=(0|e)%12!=0?(0|e)%12:12;this.ele.value=n+":"+("0"+i).slice(-2)+(s?" PM":" AM");break;default:this.ele.value=null!=t[this.prop]?t[this.prop]:""}}}}class ot extends Z{constructor(t,e,s){super(t,e,s),this.prop=e.prop}down(t,e=null,s){if(e)for(var i=0,n=e.length;i<n;i++){if(e[i]==this.prop&&void 0!==t[this.prop])return{value:t[this.prop]};if(i==n-1)return null}else if(void 0!==t[this.prop])return{value:t[this.prop]}}__down__(t,e=null,s=!1){let i=this.down(t,e,s);if(i)for(let t=0,e=this.children.length;t<e;t++)this.children[t].__down__(i,[this.prop],s)}up(t){if(void 0!==t.value){let e={};return e[this.prop]=t.value,e}return null}}class lt extends Z{constructor(t,e,s){super(t,e,s)}down(t){return{value:`<b>${t.value}</b>`}}}lt.ADDS_TAGS=!0,lt.CAN_BE_STATIC=!0;class at extends Z{constructor(t,e,s){super(t,e,s),this.prop=e.prop}up(){}down(t){this.ele.innerHTML=t.value}}class ut{constructor(){this.html="",this.children=[],this.tag_index=1}addChild(t){t.parent=this,this.children.push(t)}constructSkeleton(t){let e=document.createElement("div");e.innerHTML=this.html;let s=new rt(e);for(let e=0,i=this.children.length;e<i;e++)this.children[e].constructSkeleton(s,t);return s}getIndex(){return this.tag_index++}toJSON(){return{children:this.children,html:this.html}}offset(t=0){let e=this.tag_count;return this.tag_count+=t,e}}class ct{constructor(t,e,s){this.parent=null,this.tagname=t,this.attributes=e||{},this.IS_NULL=!1,this.CONSUMES_TAG=!0,this.CONSUMES_SAME=!1,this.children=[],this.prop_name=null,this.html="",this.open_tag="",this.close_tag="",this.tag_index=0,this.index=0,s&&s.addChild(this)}finalize(t){t.html+=this.open_tag+this.html+this.close_tag}replaceChild(t,e){for(let s=0;s<this.children.length;s++)if(this.children[s]==t)return this.children[s]=e,e.parent=this,void(t.parent=null)}removeChild(t){for(let e=0;e<this.children.length;e++)if(this.children[e]==t)return this.children.splice(e,1)}addChild(t){if(t instanceof _t&&!(this instanceof dt))return this.parent.addChild(t);t.parent=this,this.children.push(t)}parseAttributes(){let t={};return t.prop=this.prop_name,this.attributes,t}addProp(t,e,s,i){this.prop_name!==e?this.split(new wt(e,this.attributes,null,this,this.getIndex()),e):new wt(e,this.attributes,this,this,this.getIndex())}toJSON(){return{children:this.children,tagname:this.tagname,tag_count:this.tag_count,tag:{open_tag:this.open_tag,close_tag:this.close_tag},html:this.html}}split(t,e){if(t){if(!this.prop_name)return this.addChild(t),this.prop_name=e,this.parent.removeChild(this),this.parent.split(this,e);if(e!=this.prop_name){let s=new this.constructor(this.tagname,this.attributes,null);return s.CONSUMES_SAME=!!s.CONSUMES_TAG&&!(s.CONSUMES_TAG=!1),s.prop_name=e,s.addChild(t),this.parent.split(s,e)}this.addChild(t)}else{if(!this.prop_name)return this.parent.removeChild(this),this.parent.split(this,e);if(e!=this.prop_name){let t=new this.constructor(this.tagname,this.attributes,null);return t.prop_name=e,this.parent.split(t,e)}}return-1}getIndex(){return this.tag_index>0?this.tag_index++:this.parent?this.parent.getIndex():void 0}constructSkeleton(t,e){let s=this.createSkeletonConstructor(e);t.children.push(s);for(let t=0;t<this.children.length;t++)this.children[t].constructSkeleton(s,e)}createSkeletonConstructor(t){return new rt(this.getElement(),this.getConstructor(t),this.parseAttributes(),t,this.index)}getConstructor(){return null}getElement(){return null}}class dt extends ct{constructor(t,e,s){super(t,e,s)}finalize(t){t.html+=this.html}addProp(t,e,s,i){if("("==t.text&&"("==t.peek().text){t.assert("("),t.assert("("),new pt("list",this.attributes,this,this).parse(t,s,i),t.assert(")");let e=t.pos+1;return t.assert(")"),e}}getConstructor(){return st}split(t,e){t&&this.addChild(t)}}class pt extends ct{constructor(t,e,s,i){super(t,e,s),this.index=this.getIndex(),i.html+=`<list>##:${this.index}</list>`,this.filters=[],this.terms=[],this.templates=[]}addChild(t){if(t instanceof ft)this.filters.push(t);else if(t instanceof mt)this.terms.push(t);else{if(!(t instanceof dt))throw new Error("Templates only support Filter, Term or Source elements.");if(this.templates.length>0)throw new Error("Only one Source allowed in a Template.");this.templates.push(t),t.tag_index=1,this.html=t.html}}constructSkeleton(t,e){let s=document.createElement("div");s.innerHTML=this.html;let i=new rt(this.getElement(),it,this.parseAttributes(),e,this.index);i.filters=this.filters.map(t=>t.createSkeletonConstructor(e)),i.terms=this.terms.map(t=>t.createSkeletonConstructor(e)),i.templates=this.templates.map(t=>{let i=t.createSkeletonConstructor(e);return i.ele=s,i}),t.children.push(i)}getElement(){return document.createElement("list")}addProp(t,e,s,i){}parse(t,e,s){for(;")"!==t.text&&")"!==t.peek().text;){if(!t.text)throw new Error("Unexpected end of Output. Missing '))' ");let i=e(t,this,s);i instanceof dt&&(this.html=i.html)}}split(t,e){return t&&this.addChild(t),this.tag_count}}class _t extends ct{constructor(t,e,s){super(t,e,s)}finalize(t){t.html+=this.html}getConstructor(t){return ot}}class ft extends ct{constructor(t,e,s){super(t,e,s),this.CONSUMES_TAG=!1}finalize(t){}getConstructor(t){return ot}addProp(t,e,s,i){this.attributes.prop=e}}class mt extends ct{constructor(t,e,s){super(t,e,s)}finalize(t){}getConstructor(t){return ot}addProp(t,e,s,i){this.attributes.prop=e}}class gt extends ct{constructor(t,e,s){super(t,e,s)}finalize(t,e){t.html+=this.html}getConstructor(t,e=!1){return lt}split(t,e){if(!(this.parent instanceof gt||this.parent instanceof _t)){let t=new _t("",{},null);this.prop_name=this.prop_name,this.parent.replaceChild(this,t),t.addChild(this)}super.split(t,e)}}class wt extends ct{constructor(t,e,s,i,n){super("",null,s),this.index=n,i.html+=`<io prop="${t}">##:${n}</io>`,this.prop_name=t,this.CONSUMES_TAG=!0}getConstructor(t){return at}}function yt(t,e,s){let i;return t?t.skeleton?t.skeleton:(i=function(t,e,s){if("TEMPLATE"===t.tagName){t.id;let s=t.innerHTML,i=b(s);if("<"==i.text){let t=new ut;return vt(i,t,e),t.constructSkeleton(e)}}return null}(document.importNode(t,!0),e))?(t.skeleton=(t=>e=>t.flesh(e))(i),t.skeleton):null:null}function vt(t,e,s){let i=t.pos,n={};t.assert("<");let r=t.text;if("identifier"!=t.type)throw new Error(`Expected tag-name identifier, got ${t.text}`);t.next(),function(t,e){for(;">"!==t.text&&"/"!==t.text;){if(!t.text)throw Error("Unexpected end of input.");let s=t.text,i=null;if(t.next(),"="==t.text){if(t.next(),"string"!=t.token.type)throw new Error("Expecting attribute definition.");i=t.text.slice(1,-1),t.next()}e[s]=i}"/"==t.text&&t.assert("/");t.assert(">")}(t,n);let h=function(t,e,s,i){let n;switch(e){case"w":case"w-a":case"w_a":return n=new _t(e,s,i);case"w-filter":return n=new ft(e,s,i);case"w-term":return n=new mt(e,s,i);case"w-c":case"w_c":case"w-case":case"w_case":return n=new dt(e,s,i);default:if("w"==e[0])return n=new gt(e,s,i)}return n=new ct(e,s,i)}(0,r,n,e);for(h.open_tag+=t.slice(i),i=t.token.pos;;){if(!t.text)throw"Unexpected end of output";switch(t.text){case"<":if("/"==t.peek().text){h.html+=t.slice(i),i=t.pos,t.assert("<"),t.assert("/"),t.assert(r);let n=t.pos+1;return t.assert(">"),h.close_tag=t.slice(i),h.finalize(e||{html:""},s),n}i=vt(t,h);break;case"[":h.html+=t.slice(i),t.next();let n=t.text;t.next(),i=t.pos+1,t.assert("]"),i=h.addProp(t,n,vt,s)||i;break;default:t.next()}}}class xt{constructor(t){this.path=t.pathname,this.host=t.hostname,this.query=function(t){let e=new Map;if(!t instanceof String)return console.warn("query argument provided is not a string!"),e;function s(t,e){let s;for(;(s=t.token)&&"&"!==s.text;){if("="!=t.peek().text)return;{let i=s.text;t.next(),t.next();let n=t.token;e.set(i,"number"==n.type?parseFloat(n.text):n.text),t.next(),t.next()}}}function i(t,e){let i;return!(!(i=t.peek())||"&"!=i.text||(i=t.token,t.next(),t.next(),e.set(i.text,new Map),s(t,e.get(i.text)),0))}return"?"==t[0]&&(t=t.slice(1)),function(t,e){for(e.set(null,new Map),"&"==t.peek().text?i(t,e):s(t,e.get(null));t.token&&"&"==t.token.text;)t.next(),i(t,e)}(new n(new u(t)),e),e}(t.search.slice(1))}setPath(t){this.path=t,this.setLocation()}setLocation(){history.replaceState({},"replaced state",`${this}`),window.onpopstate()}toString(){return`${this.path}?${function(t){let e,s="";if(e=t.get(null)){if(e.length>0)for(let[t,i]of e.entries())s+=`&${t}=${i}`;for(let[e,i]of t.entries())if(null!=e){s+=`&${e}`;for(let[t,e]of i.entries())s+=`&${t}=${e}`}return s.slice(1)}return s}(this.query)}`}getClass(t){t||(t=null);let e,s={};if(e=this.query.get(t))for(let[t,i]of e.entries())s[t]=i;return s}set(t,e,s){t||(t=null),this.query.has(t)||this.query.set(t,new Map),this.query.get(t).set(e,s),this.setLocation()}get(t,e){t||(t=null);let s=this.query.get(t);return s?s.get(e):null}}class kt{constructor(t,e){this.url=t,this.eles=[],this.finalizing_view=null,this.type="normal",this.ele=e,this.ele_backer=null,this.LOADED=!1}destructor(){for(var t=0;t<this.eles.length;t++){this.eles[t].destructor()}this.eles=null,this.ele=null}unload(t){this.LOADED=!1;for(var e=0;e<this.eles.length;e++){let s=this.eles[e];s.getTransformTo(t),s.unloadComponents()}}transitionOut(t){let e=0;for(var s=0;s<this.eles.length;s++)e=Math.max(e,this.eles[s].transitionOut(t));return e}finalize(){if(!this.LOADED){for(var t=0;t<this.eles.length;t++){this.eles[t].finalize()}this.ele.parentElement&&this.ele.parentElement.removeChild(this.ele)}}load(t,e){this.LOADED=!0;for(var s=0;s<this.eles.length;s++){this.eles[s].loadComponents(e)}t.appendChild(this.ele);this.ele.style.opacity}transitionIn(t){"modal"==this.type&&(this.ele_backer||(this.ele_backer=document.createElement("div"),this.ele_backer.classList.add("modal_backer"),this.ele.appendChild(this.ele_backer)),setTimeout(()=>{this.ele.style.opacity=1},50));for(var e=0;e<this.eles.length;e++){let s=this.eles[e];s.parent=this,s.setTransformTo(t),s.transitionIn()}}getNamedElements(t){for(var e=0;e<this.eles.length;e++){this.eles[e].getNamedElements(t)}}compareComponents(){}setType(t){this.type=t||"normal"}}class bt extends Float64Array{constructor(t,e,s,i=0){super(4),this.r=0,this.g=0,this.b=0,this.a=1,"string"==typeof t?this.fromString(t):(this.r=t,this.g=e,this.b=s,this.a=i)}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get a(){return this[3]}set a(t){this[3]=t}set(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=null!=t.a?t.a:this.a}add(t){return new bt(t.r+this.r,t.g+this.g,t.b+this.b,t.a+this.a)}mult(t){return"number"==typeof t?new bt(this.r*t,this.g*t,this.b*t,this.a*t):new bt(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}sub(t){return new bt(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}toString(){return`rgba(${0|this.r}, ${0|this.g}, ${0|this.b}, ${this.a})`}fromString(t){let e,s,i,n,r=b(t);switch(r.token.text){case"rgb":r.next(),e=parseInt(r.next().text),r.next(),s=parseInt(r.next().text),r.next(),i=parseInt(r.next().text),this.set({r:e,g:s,b:i});break;case"rgba":r.next(),e=parseInt(r.next().text),r.next(),s=parseInt(r.next().text),r.next(),i=parseInt(r.next().text),r.next(),n=parseFloat(r.next().text),this.set({r:e,g:s,b:i,a:n});break;case"#":r.next().text;break;default:bt.colors[t]&&this.set(bt.colors[t]||new bt(255,255,255,1e-4))}}}bt.colors={transparent:new bt(255,255,255,1e-4),clear:new bt(255,255,255,1e-4),red:new bt(255,0,0),green:new bt(0,255,0),blue:new bt(0,0,255),Black:new bt(0,0,0),White:new bt(255,255,255),white:new bt(255,255,255),Red:new bt(255,0,0),Lime:new bt(0,255,0),Blue:new bt(0,0,255),Yellow:new bt(255,255,0),Cyan:new bt(0,255,255),Aqua:new bt(0,255,255),Magenta:new bt(255,0,255),Fuchsia:new bt(255,0,255),Silver:new bt(192,192,192),Gray:new bt(128,128,128),Maroon:new bt(128,0,0),Olive:new bt(128,128,0),Green:new bt(0,128,0),Purple:new bt(128,0,128),Teal:new bt(0,128,128),Navy:new bt(0,0,128),maroon:new bt(128,0,0),"dark red":new bt(139,0,0),brown:new bt(165,42,42),firebrick:new bt(178,34,34),crimson:new bt(220,20,60),red:new bt(255,0,0),tomato:new bt(255,99,71),coral:new bt(255,127,80),"indian red":new bt(205,92,92),"light coral":new bt(240,128,128),"dark salmon":new bt(233,150,122),salmon:new bt(250,128,114),"light salmon":new bt(255,160,122),"orange red":new bt(255,69,0),"dark orange":new bt(255,140,0),orange:new bt(255,165,0),gold:new bt(255,215,0),"dark golden rod":new bt(184,134,11),"golden rod":new bt(218,165,32),"pale golden rod":new bt(238,232,170),"dark khaki":new bt(189,183,107),khaki:new bt(240,230,140),olive:new bt(128,128,0),yellow:new bt(255,255,0),"yellow green":new bt(154,205,50),"dark olive green":new bt(85,107,47),"olive drab":new bt(107,142,35),"lawn green":new bt(124,252,0),"chart reuse":new bt(127,255,0),"green yellow":new bt(173,255,47),"dark green":new bt(0,100,0),green:new bt(0,128,0),"forest green":new bt(34,139,34),lime:new bt(0,255,0),"lime green":new bt(50,205,50),"light green":new bt(144,238,144),"pale green":new bt(152,251,152),"dark sea green":new bt(143,188,143),"medium spring green":new bt(0,250,154),"spring green":new bt(0,255,127),"sea green":new bt(46,139,87),"medium aqua marine":new bt(102,205,170),"medium sea green":new bt(60,179,113),"light sea green":new bt(32,178,170),"dark slate gray":new bt(47,79,79),teal:new bt(0,128,128),"dark cyan":new bt(0,139,139),aqua:new bt(0,255,255),cyan:new bt(0,255,255),"light cyan":new bt(224,255,255),"dark turquoise":new bt(0,206,209),turquoise:new bt(64,224,208),"medium turquoise":new bt(72,209,204),"pale turquoise":new bt(175,238,238),"aqua marine":new bt(127,255,212),"powder blue":new bt(176,224,230),"cadet blue":new bt(95,158,160),"steel blue":new bt(70,130,180),"corn flower blue":new bt(100,149,237),"deep sky blue":new bt(0,191,255),"dodger blue":new bt(30,144,255),"light blue":new bt(173,216,230),"sky blue":new bt(135,206,235),"light sky blue":new bt(135,206,250),"midnight blue":new bt(25,25,112),navy:new bt(0,0,128),"dark blue":new bt(0,0,139),"medium blue":new bt(0,0,205),blue:new bt(0,0,255),"royal blue":new bt(65,105,225),"blue violet":new bt(138,43,226),indigo:new bt(75,0,130),"dark slate blue":new bt(72,61,139),"slate blue":new bt(106,90,205),"medium slate blue":new bt(123,104,238),"medium purple":new bt(147,112,219),"dark magenta":new bt(139,0,139),"dark violet":new bt(148,0,211),"dark orchid":new bt(153,50,204),"medium orchid":new bt(186,85,211),purple:new bt(128,0,128),thistle:new bt(216,191,216),plum:new bt(221,160,221),violet:new bt(238,130,238),magenta:new bt(255,0,255),fuchsia:new bt(255,0,255),orchid:new bt(218,112,214),"medium violet red":new bt(199,21,133),"pale violet red":new bt(219,112,147),"deep pink":new bt(255,20,147),"hot pink":new bt(255,105,180),"light pink":new bt(255,182,193),pink:new bt(255,192,203),"antique white":new bt(250,235,215),beige:new bt(245,245,220),bisque:new bt(255,228,196),"blanched almond":new bt(255,235,205),wheat:new bt(245,222,179),"corn silk":new bt(255,248,220),"lemon chiffon":new bt(255,250,205),"light golden rod yellow":new bt(250,250,210),"light yellow":new bt(255,255,224),"saddle brown":new bt(139,69,19),sienna:new bt(160,82,45),chocolate:new bt(210,105,30),peru:new bt(205,133,63),"sandy brown":new bt(244,164,96),"burly wood":new bt(222,184,135),tan:new bt(210,180,140),"rosy brown":new bt(188,143,143),moccasin:new bt(255,228,181),"navajo white":new bt(255,222,173),"peach puff":new bt(255,218,185),"misty rose":new bt(255,228,225),"lavender blush":new bt(255,240,245),linen:new bt(250,240,230),"old lace":new bt(253,245,230),"papaya whip":new bt(255,239,213),"sea shell":new bt(255,245,238),"mint cream":new bt(245,255,250),"slate gray":new bt(112,128,144),"light slate gray":new bt(119,136,153),"light steel blue":new bt(176,196,222),lavender:new bt(230,230,250),"floral white":new bt(255,250,240),"alice blue":new bt(240,248,255),"ghost white":new bt(248,248,255),honeydew:new bt(240,255,240),ivory:new bt(255,255,240),azure:new bt(240,255,255),snow:new bt(255,250,250),black:new bt(0,0,0),"dim gray":new bt(105,105,105),"dim grey":new bt(105,105,105),gray:new bt(128,128,128),grey:new bt(128,128,128),"dark gray":new bt(169,169,169),"dark grey":new bt(169,169,169),silver:new bt(192,192,192),"light gray":new bt(211,211,211),"light grey":new bt(211,211,211),gainsboro:new bt(220,220,220),"white smoke":new bt(245,245,245),white:new bt(255,255,255)};const Et=new x(.5,.2,0,1);requestAnimationFrame||(requestAnimationFrame=(t=>{setTimeout(t,1e3)}));class Tt{constructor(t){var e=t.getBoundingClientRect();this.color=new bt(window.getComputedStyle(t,null).getPropertyValue("background-color")),this.height=parseFloat(window.getComputedStyle(t,null).getPropertyValue("height")),this.width=parseFloat(window.getComputedStyle(t,null).getPropertyValue("width")),this.height=e.height,this.width=e.width,this.left=parseFloat(e.left),this.top=parseFloat(e.top),this.ele=t}destructor(){this.ele=null,this.color=null}start(){this.ele.style.opacity=0}end(){this.ele.style.opacity=1}}class St extends Tt{constructor(t,e){super(t),this.from=e,this.res=t.style.top&&t.style.left,this.rt=t.style.top?t.style.top:null,this.rl=t.style.left?t.style.left:null;t.getParentWindowLeft();t.getParentWindowTop();var s=parseFloat(window.getComputedStyle(t,null).getPropertyValue("left")),i=parseFloat(window.getComputedStyle(t,null).getPropertyValue("top")),n=this.left-this.from.left;this.left=s,this.from.left=this.left-n;var r=this.top-this.from.top;this.top=i,this.from.top=this.top-r,this.time=21,this.s=0,this.color_o=window.getComputedStyle(t,null).getPropertyValue("background-color"),this.height_o=t.style.width,this.width_o=t.style.height,this.top_o=this.top,this.left_o=this.left,this.pos=window.getComputedStyle(t,null).getPropertyValue("position")}destructor(){this.end(),this.from=null,this.s=1/0,this.ele=null,super.destructor()}start(){this.ele.style.opacity=1,this.ele.style.top=this.from.top+"px",this.ele.style.left=this.from.left+"px",this.ele.style.width=this.from.width+"px",this.ele.style.height=this.from.height+"px"}step(){this.s++;var t=this.s/this.time;if(t>1)return!1;var e=Et.getYatX(t);return e>1&&(e=1),this.ele.style.top=Math.round((this.top-this.from.top)*e+this.from.top)+"px",this.ele.style.left=Math.round((this.left-this.from.left)*e+this.from.left)+"px",this.ele.style.width=(this.width-this.from.width)*e+this.from.width+"px",this.ele.style.height=(this.height-this.from.height)*e+this.from.height+"px",this.ele.style.backgroundColor=this.color.sub(this.from.color).mult(e).add(this.from.color)+"",t<.9999995}end(){this.ele.style.backgroundColor=null,this.ele.style.height=this.height_o,this.ele.style.width=this.width_o,this.ele.style.top=this.rt,this.ele.style.left=this.rl}}class Ct{constructor(t,e){this.b=e instanceof Tt?e:new Tt(e),this.a=new St(t,this.b),this.a.ele.__TT__&&this.a.ele.__TT__.destructor(),this.b.ele.__TT__&&this.b.ele.__TT__.destructor(),this.a.ele.__TT__=this,this.b.ele.__TT__=this,this.destroyed=!1,this.start()}destructor(){this.destroyed||(this.b.ele&&(this.b.ele.__TT__=null),this.a.ele&&(this.a.ele.__TT__=null),this.a.destructor(),this.destroyed=!0)}start(){this.b.start(),this.a.start()}step(){return this.a.step()}}const Mt=new class{constructor(){this.pairs=[],this.____SCHEDULED____=!1}pushPair(t){this.pairs.push(t),P.queueUpdate(this)}update(t){let e=this.pairs;e.length>0&&P.queueUpdate(this);for(var s=0;s<e.length;s++){var i=e[s];i.step(t)||(i.destructor(),e.splice(s,1),s--)}}};function At(t,e,s){if(!e){return(t=>(e,s)=>{let i=new Ct(e,t);Mt.pushPair(i)})(new Tt(t))}var i=new Ct(e,t);Mt.pushPair(i),i.start()}var Ot=Object.freeze({AnimCore:class{constructor(){this.anim_group={},this.running_animations=[]}step(t){var e=this.running_animations.lenght;if(e>0)for(var s=0;s<e;s++){var i=this.running_animations[s];i&&!i.step(t)&&(i.destructor(),this.running_animations[s]=null)}}addBloc(t){}},TransformTo:At,Color:bt});class Lt extends Z{constructor(t){super(null,t,{},{}),this.anchor=null,this.LOADED=!1,this.transitioneer=new Q,this.transitioneer.set(this.ele)}getNamedElements(t){let e=this.ele.children;for(var s=0;s<e.length;s++){let i=e[s];i.dataset.transition&&(t[i.dataset.transition]=i)}}}class It extends Z{constructor(t,e){var s=document.createElement("div");s.innerHTML=`<h3> This Wick component has failed!</h3> <h4>Error Message:</h4><p>${t.stack}</p><p>Please contact the website maintainers to address the problem.</p> <p>${e.error_contact}</p>`,super(null,s,{},{}),this.transitioneer=new Q,this.transitioneer.set(this.ele)}}class Dt{constructor(t){this.id=t.classList?t.classList[0]:t.id,this.components=[],this.bubbled_elements=null,this.wraps=[],this.ele=t}unloadComponents(){for(var t=0;t<this.components.length;t++)this.components[t].LOADED=!1}transitionOut(){let t=0;for(var e=0;e<this.components.length;e++){let s=this.components[e];s.LOADED||(s.parent=null,t=Math.max(s.transitionOut(),t))}return t}finalize(){for(var t=0;t<this.components.length;t++){let e=this.components[t];!e.LOADED&&e.parentElement&&(e.finalizeTransitionOut(),this.wraps[t].removeChild(e.ele)),e.LOADED=!1}}loadComponents(t){for(let e=0;e<this.components.length;e++){let s=this.components[e];s.parent=this,s.ele.parentElement&&s.ele.parentElement.removeChild(s.ele),this.wraps[e].appendChild(s.ele),s.handleUrlUpdate(t),this.components[e].LOADED=!0}}transitionIn(){let t=this.ele.style.top;this.ele.style.top=t;for(let t=0;t<this.components.length;t++){this.components[t].transitionIn()}}bubbleLink(t,e,s={}){this.bubbled_elements=s,history.pushState({},"ignored title",t),window.onpopstate()}getTransformTo(t){if(t){let e={};this.getNamedElements(e);for(let s in e)t[s]=At(e[s])}}setTransformTo(t){if(t){let e={};this.getNamedElements(e);for(let s in e){let i,n=t[s];(i=e[s])&&n&&n(i,!1)}}}getNamedElements(t){if(this.bubbled_elements){this.bubbled_elements;for(let e in this.bubbled_elements)t[e]=this.bubbled_elements[e];return}let e=this.ele.children;for(var s=0;s<e.length;s++){let i=e[s];i.dataset.transition&&(t[i.dataset.transition]=i)}for(s=0;s<this.components.length;s++){this.components[s].getNamedElements(t)}}setComponents(t,e,s,i,n,r){var h=Array.prototype.map.call(this.ele.getElementsByTagName("component"),t=>t);if(function(t,e){let s=t.getElementsByTagName("a");for(let t=0,i=s.length;t<i;t++){let i=s[t];i.dataset.ignore_link||i.origin===location.origin&&(i.onclick||(i.onclick=((t,e,s)=>i=>{i.preventDefault(),s(t,e)&&i.preventDefault()})(i.href,i,e)))}}(this.ele,(t,e)=>(history.pushState({},"ignored title",t),window.onpopstate(),!0)),h.length<1){let t=document.createElement("div");t.classList.add("comp_wrap"),t.innerHTML=this.ele.innerHTML}for(var o=n.getElementsByTagName("template"),l=0;l<h.length;l++){let p=null,_=h[l];try{let h=document.createElement("div");h.classList.add("comp_wrap"),this.wraps.push(h),_.parentElement.replaceChild(h,_);var a,u=_.classList[0];if(u){if(t[u])p=t[u];else{if(a=s[u]){if(p=new a.constructor(o,i,_,n),a.model_name&&e[a.model_name]){var c=e[a.model_name];c.getter&&c.getter.get(),c.addView(p)}p.id=u,t[u]=p}else{var d=o[u];if(d)p=yt(d,i)();else{let t=yt(_,i);t||(t=yt(_.children[0],i)),p=t?t():new Lt(_)}}p?t[u]=p:(console.warn("App Component not constructed"),p=new It)}p.handleUrlUpdate(r)}else p=new Lt(_)}catch(t){console.log(t),p=new It(t,i)}this.components.push(p)}}}const Nt={wurl:null},Pt={set:function(t,e,s){Nt.wurl&&Nt.wurl.set(t,e,s)},get:function(t,e){return Nt.wurl?Nt.wurl.set(t,e):null},goto:function(t,e){history.pushState({},"ignored title",`${t}${e?`?${k(e)}`:""}`),window.onpopstate()}};function Ft(){let t=document.getElementsByTagName("modals")[0];if(!t){t=document.createElement("modals");var e=document.getElementsByTagName("app")[0];e?e.parentElement.insertBefore(t,e):document.body.appendChild(t)}return t}class $t{constructor(t){t.router=this,this.pages={},this.components={},this.component_constructors={},this.models_constructors={},this.presets=t,this.current_url=null,this.current_query,this.current_view=null,this.finalizing_pages=[],this.modal_stack=[],window.onpopstate=(()=>{this.parseURL(document.location)})}parseURL(t){let e=t.pathname,s=this.current_url==e,i=null,n=new xt(t);if(this.current_url=e,i=this.pages[e])return s?(Nt.wurl=n,i.transitionIn("modal"==i.type?Ft():document.getElementsByTagName("app")[0],null,n,s)):this.loadPage(i,n,s);t&&fetch(t.href,{credentials:"same-origin",method:"GET"}).then(t=>{t.text().then(t=>{var i=(new DOMParser).parseFromString(t,"text/html");this.loadPage(this.loadNewPage(e,i,n),n,s)})}).catch(t=>{console.warn(`Unable to process response for request made to: ${this.url}. Response: ${t}. Error Received: ${t}`)})}finalizePages(){if(this.armed){this.armed;this.armed=null}for(var t=0,e=this.finalizing_pages.length;t<e;t++){this.finalizing_pages[t].finalize()}this.finalizing_pages.length=0}loadPage(t,e=new xt(document.location),s){Nt.wurl=e;let i=0,n=document.getElementsByTagName("app")[0],r={};if("modal"==t.type){if(s)return void t.transitionIn();let n=0;for(var h=0,o=this.modal_stack.length;h<o;h++){let e=this.modal_stack[h];if(0==n)e==t&&(n=h+1);else{let t=0;e.unload(),(t=e.transitionOut())?(i=Math.max(t,i),this.finalizing_pages.push(e)):e.finalize()}}n>0?(this.modal_stack.length=n,t.load(Ft(),e),t.transitionIn()):(this.modal_stack.push(t),t.load(Ft(),e),t.transitionIn())}else{for(h=0,o=this.modal_stack.length;h<o;h++){let t=this.modal_stack[h],e=0;t.unload(),(e=t.transitionOut())?(i=Math.max(e,i),this.finalizing_pages.push(t)):t.finalize()}if(this.modal_stack.length=0,this.current_view&&this.current_view!=t){this.current_view.unload(r),t.load(n,e);let s=this.current_view.transitionOut();window.requestAnimationFrame(()=>{t.transitionIn(r)}),i=Math.max(s,i),this.finalizing_pages.push(this.current_view)}else this.current_view||(t.load(n,e),window.requestAnimationFrame(()=>{t.transitionIn(r)}));this.current_view=t}setTimeout(()=>{this.finalizePages()},1e3*i+1)}addStatic(t,e,s){this.component_constructors[t]={constructor:e,model_name:s}}addModel(t,e){this.models_constructors[t]=e}loadNonWickPage(t){let e=document.createElement("iframe");e.src=t,e.classList.add("modal","comp_wrap");var s=new kt(t,e);return s.type="modal",this.pages[t]=s,this.pages[t]}loadNewPage(t,e,s){let i=!1,n=e.getElementsByTagName("app");n.length>1&&console.warn(`Wick is designed to work with just one <app> element in a page. There are ${n.length} apps elements in ${url}. Wick will proceed with the first <app> element in the DOM. Unexpected behavior may occur.`);let r=n[0];if(!r)return console.warn("Page does not have an <app> element!"),this.loadNonWickPage(t);var h=document.createElement("apppage");h.innerHTML=r.innerHTML;var o=r.cloneNode(!0),l=document.getElementsByTagName("app")[0],a=new kt(t,h);if(r){if("true"==r.dataset.modal){a.setType("modal");let t=document.createElement("modal");if(t.innerHTML=o.innerHTML,o.innerHTML="",o=t,e==document&&l){let t=document.createElement("app");document.body.replaceChild(t,l),l=t}}"true"==o.dataset.no_buffer&&(i=!0);for(var u=h.getElementsByTagName("element"),c=0;c<u.length;c++){let t,i=u[c],n=i.id;if("modal"!==a.type)t=new Dt(i);else{let e=document.createElement("div");e.innerHTML=i.innerHTML,e.classList.add("ele_wrap"),t=new Dt(i)}a.eles.push(t),this.components[n]||(this.components[n]={}),t.setComponents(this.components[n],this.models_constructors,this.component_constructors,this.presets,e,s)}document==e&&(l.innerHTML="");let n=a;return i||(this.pages[t]=n),n}}}const qt=" (  (                    )\n )\\))(   ' (          ( /(\n((_)()\\ )  )\\    (    )\\())\n_(())\\_)()((_)   )\\  ((_)\\\n\\ \\((_)/ / (_)  ((_) | |(_)\n \\ \\/\\/ /  | | / _|  | / /\n  \\_/\\_/   |_| \\__|  |_\\_\\\n";let Ut=!1;function zt(t){if(t.static)for(let e in t.static){let s=t.static[e],i=0,n=0,r=0,h=0;(i=s.prototype.transitionIn&&s.prototype.transitionIn instanceof Function)&&(n=s.prototype.transitionOut&&s.prototype.transitionOut instanceof Function)&&(r=s.prototype.setModel&&s.prototype.setModel instanceof Function)&&(h=s.prototype.unsetModel&&s.prototype.unsetModel instanceof Function)?this.addStatic(e,s):console.warn(`Static component ${e} lacks correct component methods, \nHas transitionIn function:${i}\nHas transitionOut functon:${n}\nHas set model function:${r}\nHas unsetModel function:${h}`)}if(t.parser)for(let e in t.page_parser){t.page_parser[e]}if(t.schemas?t.schemas.any=X:t.schemas={any:X},t.models||(t.models={}),console.log(t),Ut)return;Ut=!0;let e=new $t(t||{});window.addEventListener("load",()=>{e.loadPage(e.loadNewPage(document.location.pathname,document),new xt(document.location),!1)}),console.log(`${qt}Copyright 2018 Anthony C Weathersby\nhttps://gitlab.com/anthonycweathersby/wick`)}const Ht=W;Ht.any=(t=>new X(t)),Ht.any.constr=X,Ht.container={multi:(...t)=>new H(...t),array:(...t)=>new R(...t),btree:(...t)=>new j(...t),constr:z},Ht.container.constr.multi=H,Ht.container.constr.array=R,Ht.container.constr.btree=j,Object.freeze(Ht.container.constr),Object.freeze(Ht.container),Object.freeze(Ht.any),Object.freeze(Ht);const Rt=I;Rt.constr=t,Rt.constr.bool=L,Rt.constr.number=e,Rt.constr.string=O,Rt.constr.date=S,Rt.constr.time=M,Object.freeze(Rt.constr),Object.freeze(Rt);const jt={Common:E,Animation:Ot,view:{View:D},schema:{instances:I,SchemaConstructor:t,DateSchemaConstructor:S,TimeSchemaConstructor:M,StringSchemaConstructor:O,NumberSchemaConstructor:e,BoolSchemaConstructor:L},model:{Model:W,AnyModel:X,ModelContainerBase:z,MultiIndexedContainer:H,ArrayModelContainer:R,BTreeModelContainer:j},network:{router:{WURL:xt,URL:Pt,Router:$t},Getter:tt,Setter:class extends D{constructor(t){super(),this.url=t}destructor(){super.destructor()}set(t){var e="http://"+window.location.host+this.url+(t?"?"+this.__process_url__(t):"");fetch(e,{credentials:"same-origin",method:"POST"}).then(t=>{t.json().then(t=>{this.__process_response__(t)})}).catch(t=>{console.warn(`Unable to process response for request made to: ${this.url}. Response: ${t}. Error Received: ${t}`)})}parseJson(t){return t}__process_url__(t){var e="";for(var s in t)e+=`${s}=${t[s]}&`;return e.slice(0,-1)}__process_response__(t){this.model?(this.set(this.parseJson(t)),console.log(this.model)):console.warn(`Unable to process response for request made to: ${this.url}. There is no model attached to this request controller!`)}}},source:{CustomSource:class extends st{constructor(t,e={},s={}){super(null,t,e,s)}},SourceBase:Z,SourceConstructor:yt,Cassette:et,Form:class extends et{constructor(t,e,s,i){super(t,e,s,i),this.router=i.router,this.submitted=!1,this.schema=null,e.addEventListener("submit",e=>(console.log(e.target,this,t),this.submitted||this.submit(),this.submitted=!0,e.preventDefault(),!1))}destructor(){}accepted(t){t.text().then(e=>{this.router.loadPage(this.router.loadNewPage(t.url,(new DOMParser).parseFromString(e,"text/html")),!1)})}rejected(t){t.text().then(e=>{this.router.loadPage(this.router.loadNewPage(t.url,(new DOMParser).parseFromString(e,"text/html")),!1)})}load(t){t&&(this.schema=t.schema),super.load(t)}update(t){}submit(){let t=this.ele.action;var e=new FormData(this.ele);if(this.schema)for(let t=0,s=this.children.length;t<s;t++){let s=this.children[t];if(s instanceof ht){let t=s.ele.name,i=s.prop,n=this.schema[i];if(n&&i){let r=n.string(s.val);e.set(t,r),console.log(i,t,r,s.val)}}}fetch(t,{method:"post",credentials:"same-origin",body:e}).then(t=>{200!=t.status?this.rejected(t):this.accepted(t)}).catch(t=>{this.rejected(t)}),console.log("Wick Form Submitted",t,e)}},Filter:class extends et{constructor(t,e,s,i){super(t,e,s,i),t.filter_list.push(t=>this.filter(t)),this.ele.addEventListener("input",()=>{this.parent.update()})}update(t){return!1}filter(t){return!1}}}};Object.freeze(jt);const Vt=Ht.any;export{jt as core,Rt as schema,Ht as model,Vt as any,zt as startRouting};
