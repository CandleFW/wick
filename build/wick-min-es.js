var null_token={type:"",text:""};class Lexer{constructor(e){for(this.tk=e,this.token=e.next(),this.hold=null;this.token&&("new_line"===this.token.type||"white_space"===this.token.type||"generic"===this.token.type);)this.token=this.tk.next()}next(){if(null!==this.hold)return this.token=this.hold,this.hold=null,this.token;if(!this.token)return null;do{this.token=this.tk.next()}while(this.token&&("new_line"===this.token.type||"white_space"===this.token.type||"generic"===this.token.type));return this.token?this.token:null}assert(e){if(!this.token)return!1;var t=this.token.text==e;return t&&this.next(),t}peek(){if(this.hold)return this.hold;if(this.hold=this.tk.next(),!this.hold)return null_token;for(;this.hold&&("new_line"===this.hold.type||"white_space"===this.hold.type||"generic"===this.hold.type);)this.hold=this.tk.next();return this.hold?this.hold:null_token}}function compareCode(e){for(var t=arguments,s=1,n=t.length;s<n;s++)if(t[s]===e)return!0;return!1}function inRange(e){return e>arguments[1]&&e<arguments[2]}var string_parse_and_format_functions=function(){var e=[{type:"number",check:(e,t)=>inRange(e,47,58)?compareCode(e=t.charCodeAt(1),66,98,88,120,79,111)?2:1:46==e&&inRange(e=t.charCodeAt(1),47,58)?2:0,scanToEnd:e=>inRange(e,47,58)||46===e?-1:0,format(e){e.color="rgb(20,40,180)"}},{type:"identifier",check:e=>inRange(e,64,91)||inRange(e,96,123)?1:0,scanToEnd:e=>inRange(e,47,58)||inRange(e,64,91)||inRange(e,96,123)||compareCode(e,35,36,45,95)?-1:0,format(e){}},{type:"string",check:(e,t)=>34===e?1:0,scanToEnd:e=>34===e?1:-1,format(e){}},{type:"white_space",check:e=>32===e||9===e?1:0,scanToEnd:e=>32===e||9===e?-1:0,format(e){}},{type:"new_line",check:e=>10===e?1:0,scanToEnd:e=>0,format(e){}},{type:"open_bracket",check:e=>compareCode(e,123,40,91)?1:0,scanToEnd:e=>0,format(e){e.color="rgb(100,100,100)"}},{type:"close_bracket",check:e=>compareCode(e,125,41,93)?1:0,scanToEnd:e=>0,format(e){e.color="rgb(100,100,100)"}},{type:"Operator",check:e=>compareCode(e,42,43,60,61,62,92,38,37,33,94,124,58)?1:0,scanToEnd:e=>0,format(e){e.color="rgb(205,120,0)"}},{type:"Symbol",check:e=>1,scanToEnd:e=>0,format(e){e.color="red"}}];return e.clone=function(){return string_parse_and_format_functions()},e},SPF=string_parse_and_format_functions(),SPF_length=SPF.length;class Tokenizer{constructor(e){this.h=null,this.line=0,this.char=0,this.offset=0,this.string=e}hold(e){this.h=e}next(){var e=0;if(this.h){var t=this.h;return this.h=null,t}if(this.string.length<1)return null;var s=this.string.charCodeAt(0);let n;for(var i=0;i<SPF_length;i++){let t=(n=SPF[i]).check(s,this.string);if(t>0){this.type=n.type;var r=0;for(i=t;i<this.string.length&&!((r=n.scanToEnd(this.string.charCodeAt(i)))>-1);i++)r=0;e=i+r;break}}var o=this.string.slice(0,e);this.string=this.string.slice(e),"new_line"===n.type&&(this.char=0,this.line++);var l={type:n.type,text:o,pos:this.offset,length:e,char:this.char,line:this.line};return this.offset+=e,this.char+=e,l}}function QueryStringToQueryMap(e){let t=new Map;if(!e instanceof String)return console.warn("query argument provided is not a string!"),t;function s(e,t){let s;for(;(s=e.token)&&"&"!==s.text;){if("="!=e.peek().text)return;{let n=s.text;e.next(),e.next();let i=e.token;t.set(n,"number"==i.type?parseFloat(i.text):i.text),e.next(),e.next()}}}function n(e,t){let n;return!(!(n=e.peek())||"&"!=n.text)&&(n=e.token,e.next(),e.next(),t.set(n.text,new Map),s(e,t.get(n.text)),!0)}return"?"==e[0]&&(e=e.slice(1)),function(e,t){for(t.set(null,new Map),"&"==e.peek().text?n(e,t):s(e,t.get(null));e.token&&"&"==e.token.text;)e.next(),n(e,t)}(new Lexer(new Tokenizer(e)),t),t}function QueryMapToQueryString(e){let t,s="";if(t=e.get(null)){if(t.length>0)for(let[e,n]of t.entries())s+=`&${e}=${n}`;for(let[t,n]of e.entries())if(null!=t){s+=`&${t}`;for(let[e,t]of n.entries())s+=`&${e}=${t}`}return s.slice(1)}return s}function TurnDataIntoQuery(e){var t="";if(arguments.length>1){for(var s=0;s<arguments.length;s++)if((e=arguments[s]).component){var n=`${e.component}&`;for(var i in e)n+="component"!=i?`${i}=${e[i]}&`:"";t+=n.slice(0,-1)+"."}}else for(var i in e)t+=`${i}=${e[i]}&`;return t.slice(0,-1)}function TurnQueryIntoData(e){var t={};let s=e.split(".");return s.length>0?s.forEach(e=>{var s={};e.length>1&&e.split("&").forEach((e,n)=>{if(n<1)t[e]=s;else{let s=e.split("=");t[s[0]]=s[1]}})}):e.split("&").forEach(e=>{let s=e.split("=");t[s[0]]=s[1]}),t}class WURL{constructor(e){this.path=e.pathname,this.host=e.hostname,this.query=QueryStringToQueryMap(e.search.slice(1))}setPath(e){this.path=e,this.setLocation()}setLocation(){history.replaceState({},"replaced state",`${this}`),window.onpopstate()}toString(){return`${this.path}?${QueryMapToQueryString(this.query)}`}getClass(e){e||(e=null);let t,s={};if(t=this.query.get(e))for(let[e,n]of t.entries())s[e]=n;return s}set(e,t,s){e||(e=null),this.query.has(e)||this.query.set(e,new Map),this.query.get(e).set(t,s),this.setLocation()}get(e,t){e||(e=null);let s=this.query.get(e);return s?s.get(t):null}}class View{constructor(){this.next=null,this.model=null}destructor(){this.model&&this.model.removeView(this)}update(e){}removed(e){}added(e){}setModel(e){}reset(){}unsetModel(){this.next=null,this.model=null}}const caller=window&&window.requestAnimationFrame?window.requestAnimationFrame:e=>{setTimeout(e,1)};console.log(caller);const Scheduler=new class{constructor(){this.update_queue_a=new Array,this.update_queue_b=new Array,this.update_queue=this.update_queue_a,this.queue_switch=0,this.callback=(()=>this.update()),this.frame_time=performance.now(),this.____SCHEDULED____=!1}queueUpdate(e){if(e.____SCHEDULED____||!e.update instanceof Function)return this.____SCHEDULED____?void 0:caller(this.callback);e.____SCHEDULED____=!0,this.update_queue.push(e),this.____SCHEDULED____||(this.____SCHEDULED____=!0,caller(this.callback))}update(){this.____SCHEDULED____=!1;let e=this.update_queue;0==this.queue_switch?(this.update_queue=this.update_queue_b,this.queue_switch=1):(this.update_queue=this.update_queue_a,this.queue_switch=0);let t=performance.now(),s=t-this.frame_time;this.frame_time=t;let n=.06*s;for(let t=0,s=e.length,i=e[0];t<s;i=e[++t])i.____SCHEDULED____=!1,i.update(n);e.length=0}};class ModelBase{constructor(){this.changed_values=[]}destructor(){for(var e=this.first_view;e;)e.unsetModel(),e=e.next;this.changed_values=null}get(){return this}scheduleUpdate(e){this.first_view&&(this.changed_values.push(e),Scheduler.queueUpdate(this))}getChanged(e){for(let t=0,s=this.changed_values.length;t<s;t++)if(this.changed_values[t]==e)return this[e];return null}update(e){this.updateViews(this),this.changed_values.length=0}addView(e){if(!(e instanceof View))throw new Exception("Passed in view is not an instance of wick.View!");e.model&&e.model.removeView(e);for(var t=this.first_view;t;){if(e==t)return;t=t.next}e.model=this,e.next=this.first_view,this.first_view=e,e.setModel(this),e.update(this.get())}removeView(e){if(e instanceof View&&e.model==this)for(var t=this.first_view,s=null;t;){if(e==t)return s?s.next=e.next:this.first_view=e.next,e.next=null,e.model=null,void e.reset();s=t,t=t.next}console.warn("View not a member of Model!",e)}updateViews(){for(var e=this.first_view;e;)e.update(this,this.changed_values),e=e.next;this.changed_values.length=0}updateViewsRemoved(e){for(var t=this.first_view;t;)t.removed(e),t=t.next}updateViewsAdded(e){for(var t=this.first_view;t;)t.added(e),t=t.next}toJson(){return JSON.stringify(this,null,"\t")}}Object.defineProperty(ModelBase.prototype,"first_view",{writable:!0,configurable:!1,enumerable:!1}),Object.defineProperty(ModelBase.prototype,"changed_values",{writable:!0,configurable:!1,enumerable:!1}),Object.seal(ModelBase.prototype);class SchemaType{constructor(){this.start_value=null}parse(e){return e}verify(e,t){t.valid=!0}filter(){return!0}string(e){return e+""}}class MCArray extends Array{constructor(){super()}push(e){e instanceof Array?e.forEach(e=>{this.push(e)}):super.push(e)}__setFilters__(){}getChanged(){}toJSON(){return this}toJson(){return JSON.stringify(this,null,"\t")}}let EmptyFunction=()=>{},EmptyArray=[];class ModelContainer extends ModelBase{constructor(e){return super(),this.source=null,this.first_link=null,this.next=null,this.prev=null,this.pin=EmptyFunction,this.__filters__=EmptyArray,this.schema=e||this.constructor.schema||{},this.schema.parser&&this.schema.parser instanceof SchemaType?this.parser=this.schema.parser:this.parser=new SchemaType,this.id="",this.schema.identifier&&"string"==typeof this.schema.identifier&&(this.id=this.schema.identifier),this}destructor(){this.schema=null,this.__filters__=null,this.source&&this.source.__unlink__(this),super.destructor()}get length(){return 0}set length(e){}__defaultReturn__(e){if(e)return new MCArray;let t=new this.constructor(this.schema);return this.__link__(t),t}push(e){return this.insert(e,!0)}get(e,t){let s=null,n=!0;if(e?t?s=t:(null===t&&(n=!1),this.source||(n=!1),(s=this.__defaultReturn__(n)).__setFilters__(e)):s=this.__defaultReturn__(n),e){let t=e;!e instanceof Array&&(t=[e]),this.__get__(t,s)}else this.__getAll__(s);return s}insert(e,t=!1){let s=this.first_view?[]:null,n=!1;if(!t&&this.source)return this.source.insert(e);if(e instanceof Array)for(var i=0;i<e.length;i++)this.__insertSub__(e[i],n,s)&&(n=!0);else e&&(n=this.__insertSub__(e,n,s));return s&&s.length>0&&this.updateViewsAdded(s),n}__insertSub__(e,t,s){let n=e;var i=this.__getIdentifier__(e);return null!=i&&(n instanceof this.schema.model||(n=n.____self____)||(n=new this.schema.model).add(e),(i=this.__getIdentifier__(n,this.__filters__))&&(t=this.__insert__(n,s,i),this.__linksInsert__(n))),t}remove(e,t=!1){if(!t&&this.source)return this.source.remove(e);let s=[];if(e){let t=e;!e instanceof Array&&(t=[e]),this.__remove__(t,s)}else this.__removeAll__();return this.__linksRemove__(terms),s}__unlink__(e){e instanceof ModelContainer&&e.source==this&&(e==this.first_link&&(this.first_link=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next),e.source=null)}__link__(e){e instanceof ModelContainer&&!e.source&&(e.source=this,e.next=this.first_link,this.first_link&&(this.first_link.prev=e),this.first_link=e,e.pin=(e=>{let t=setTimeout(()=>{e.__unlink__()},50);return()=>{clearTimeout(t),e.source||console.warn("failed to clear the destruction of container in time!")}})(e))}__linksRemove__(e){let t=this.first_link;for(;t;)t.remove(e,!0),t=t.next}__linksInsert__(e){let t=this.first_link;for(;t;)t.insert(e,!0),t=t.next}cull(e){let t=__getAll__([],!0),s=e=>{if(e instanceof Array)return e.forEach(e=>s(e));this.__getIdentifier__(e)};s(e);for(let e=0;e<t.lenth;e++){let s=t[e];t[this.__getIdentifier__(s)]||this.__remove__(s)}this.insert(e)}__setFilters__(e){e instanceof Array?this.__filters__=this.__filters__.concat(e):this.__filters__.push(e)}__filterIdentifier__(e,t){return!(t.length>0)||this.parser.filter(e,t)}__getIdentifier__(e,t=null){let s=null;return s="object"==typeof e?e[this.schema.identifier]:e,t&&s?this.__filterIdentifier__(s,t)?s:void 0:s}__insert__(e,t,s){return!1}__get__(e,t){return t}__getAll__(e){return e}__removeAll__(){return[]}__remove__(e){return[]}}class MultiIndexedContainer extends ModelContainer{constructor(e){super({identifier:"indexed",model:e.model}),this.schema=e,this.indexes={},this.first_index=null,this.addIndex(e.index)}get length(){return this.first_index.length}addIndex(e){for(let t in e){let s=e[t];s.container&&!this.indexes[t]&&(this.indexes[t]=new s.container(s.schema),this.first_index?this.indexes[t].insert(this.first_index.__getAll__()):this.first_index=this.indexes[t])}}get(e,t){let s={};if(e)for(let n in e)this.indexes[n]&&(s[n]=this.indexes[n].get(e[n],t));else s=this.first_index.get(null);return s}remove(e){var t=[];for(let s in e)this.indexes[s]&&(t=t.concat(this.indexes[s].remove(e[s])));for(var s=0;s<this.indexes.length;s++)for(var n=0;n<t.length;n++)this.indexes[s].remove(t[n]);return t.length>0&&this.updateViewsRemoved(t),t}__insert__(e,t,s){let n=!1;for(let t in this.indexes){this.indexes[t].insert(e)&&(n=!0)}return n&&this.updateViews(this.first_index.get()),n}__remove__(e){let t=!1;for(let s in this.indexes){this.indexes[s].remove(e)&&(t=!0)}return t}__removeAll__(){let e=!1;for(let t in this.indexes)index.__removeAll__()&&(e=!0);return e}__getIdentifier__(e,t=null){return!0}toJSON(){return"[]"}}Object.defineProperty(ModelContainer.constructor,"__filters__",{writable:!0,enumerable:!1,configurable:!1,value:EmptyArray}),Object.defineProperty(ModelContainer.constructor,"prev",{writable:!0,enumerable:!1,configurable:!1,value:null}),Object.defineProperty(ModelContainer.constructor,"next",{writable:!0,enumerable:!1,configurable:!1,value:null}),Object.defineProperty(ModelContainer.constructor,"first_link",{writable:!0,enumerable:!1,configurable:!1,value:null}),Object.defineProperty(ModelContainer.constructor,"source",{writable:!0,enumerable:!1,configurable:!1,value:null}),Object.defineProperty(ModelContainer.constructor,"pin",{writable:!0,enumerable:!1,configurable:!1,value:null}),Object.defineProperty(ModelContainer.constructor,"schema",{writable:!0,enumerable:!1,configurable:!1,value:null});class ArrayModelContainer extends ModelContainer{constructor(e){super(e),this.data=[]}destructor(){this.data=null,super.destructor()}get length(){return this.data.length}__defaultReturn__(){if(this.source)return new MCArray;let e=new ArrayModelContainer(this.schema);return this.__link__(e),e}__insert__(e,t,s){for(var n=0,i=this.data.length;n<i;n++){var r=this.data[n];if(this.__getIdentifier__(r)==s)return r.add(e),!1}return this.data.push(e),t&&t.push(e),!0}__get__(e,t,s=!1){let n=null;if(n=e instanceof Array?e:[e],s)for(let e=0,s=this.data.length;e<s;e++){let s=this.data[e];this.__getIdentifier__(s,n)&&t.push(s)}else for(let e=0,s=this.data.length;e<s;e++){let s=this.data[e];this.__getIdentifier__(s,n)&&t.push(s.get())}return t}__getAll__(e,t=!1){return t?this.data.forEach(t=>{e.push(t)}):this.data.forEach(t=>{e.push(t.get())}),e}__removeAll__(){let e=this.data.map(e=>e)||[];return this.data.length=0,e}__remove__(e){if(this.__getIdentifier__(e))for(var t=0,s=this.data.length;t<s;t++){var n=this.data[t];if(this.__getIdentifier__(n)==this.__getIdentifier__(e))return this.data.splice(t,1),[n]}return[]}toJSON(){let e="[";for(var t=0,s=this.data.length;t<s;t++)e+=`${JSON.stringify(this.data[t])} ${t+1==s?",":""}`;return e.slice(-1)+"]"}}class BTreeModelContainer extends ModelContainer{constructor(e){super(e),this.root=null,this.min=10,this.max=20,this.size=0}destructor(){this.root&&this.root.destructor(),super.destructor()}get length(){return this.size}__insert__(e,t,s){let n={added:!1};return this.root||(this.root=new BtreeNode(!0)),this.root=this.root.insert(s,e,this.max,!0,n).newnode,t&&t.push(e),n.added&&this.size++,n.added}__get__(e,t){if(this.root&&e.length>0)if(1==e.length)this.root.get(parseFloat(e[0]),parseFloat(e[0]),t);else if(e.length<3)this.root.get(parseFloat(e[0]),parseFloat(e[1]),t);else for(let s=0,n=e.length-1;s>n;s+=2)this.root.get(parseFloat(e[s]),parseFloat(e[s+1]),t);return t}__remove__(e){let t=!1;if(this.root&&e.length>0)if(1==e.length){let s=this.root.remove(e[0],e[0],!0,this.min);t=!!s.out||t,this.root=s.out_node}else if(e.length<3){let s=this.root.remove(e[0],e[1],!0,this.min);t=!!s.out||t,this.root=s.out_node}else for(let s=0,n=e.length-1;s>n;s+=2){let n=this.root.remove(e[s],e[s+1],!0,this.min);t=!!n.out||t,this.root=n.out_node}return t&&this.size--,t}__getAll__(e){return this.root&&this.root.get(-1/0,1/0,e),e}__removeAll__(){this.root&&this.root.destructor(),this.root=null}toJSON(){let e=[];return this.root&&this.root.get(-1/0,1/0,e),e}}class BtreeNode{constructor(e=!1){this.LEAF=e,this.nodes=[],this.keys=[],this.items=0}destructor(){if(this.nodes=null,this.keys=null,!this.LEAF)for(let e=0,t=this.nodes.length;e<t;e++)this.nodes[e].destructor()}balanceInsert(e,t=!1){if(this.keys.length>=e){let s=new BtreeNode(this.LEAF),n=e>>1|0,i=this.keys[n],r=this.keys.slice(0,n),o=this.nodes.slice(0,this.LEAF?n:n+1),l=this.keys.slice(this.LEAF?n:n+1),a=this.nodes.slice(this.LEAF?n:n+1);if(s.keys=l,s.nodes=a,this.keys=r,this.nodes=o,t){let e=new BtreeNode;return e.keys.push(i),e.nodes.push(this,s),{newnode:e,key:i}}return{newnode:s,key:i}}return{newnode:this,key:0}}insert(e,t,s,n=!1,i){let r=this.keys.length;if(this.LEAF){for(let r=0,o=this.keys.length;r<o;r++){let o=this.keys[r];if(e==o)return this.nodes[r].add(o),i.added=!1,{newnode:this,key:e};if(e<o)return this.keys.splice(r,0,e),this.nodes.splice(r,0,t),i.added=!0,this.balanceInsert(s,n)}return this.keys.push(e),this.nodes.push(t),i.added=!0,this.balanceInsert(s,n)}{for(var o=0;o<r;o++){if(e<this.keys[o]){let r=this.nodes[o],l=r.insert(e,t,s,!1,i),a=l.key,h=l.newnode;return h!=r&&(this.keys.splice(o,0,a),this.nodes.splice(o+1,0,h)),this.balanceInsert(s,n)}}let l=this.nodes[o],{newnode:a,key:h}=l.insert(e,t,s,!1,i);return a!=l&&(this.keys.push(h),this.nodes.push(a)),this.balanceInsert(s,n)}}balanceRemove(e,t){let s=this.nodes[e-1],n=this.nodes[e+1],i=this.nodes[e];if(s&&s.keys.length>t){let t=s.keys.length,n=s.nodes.length;return i.keys.unshift(i.LEAF?s.keys[t-1]:this.keys[e-1]),i.nodes.unshift(s.nodes[n-1]),this.keys[e-1]=s.keys[t-1],s.keys.length=t-1,s.nodes.length=n-1,!1}if(n&&n.keys.length>t)return i.keys.push(i.LEAF?n.keys[0]:this.keys[e]),i.nodes.push(n.nodes[0]),n.keys.splice(0,1),n.nodes.splice(0,1),this.keys[e]=i.LEAF?n.keys[1]:n.keys[0],!1;{s||(e++,s=i,i=n);let t=this.keys[e-1];if(this.keys.splice(e-1,1),this.nodes.splice(e,1),s.nodes=s.nodes.concat(i.nodes),s.LEAF||s.keys.push(t),s.keys=s.keys.concat(i.keys),s.LEAF)for(let e=0;e<s.keys.length;e++)s.keys[e],s.nodes[e].id;return!0}}remove(e,t,s=!1,n){let i=this.keys.length,r=!1,o=this;if(this.LEAF)for(let s=0,n=this.keys.length;s<n;s++){let i=this.keys[s];i<=t&&i>=e&&(r=!0,this.keys.splice(s,1),this.nodes.splice(s,1),n--,s--)}else{for(var l=0;l<i;l++){e<=this.keys[l]&&this.nodes[l].remove(e,t,!1,n).out&&(r=!0)}this.nodes[l].remove(e,t,!1,n).out&&(r=!0);for(l=0;l<this.nodes.length;l++)this.nodes[l].keys.length<n&&this.balanceRemove(l,n)&&(i--,l--);1==this.nodes.length&&(o=this.nodes[0])}return{out_node:o,out:r}}get(e,t,s){if(!e||!t)return!1;if(this.LEAF)for(let n=0,i=this.keys.length;n<i;n++){let i=this.keys[n];i<=t&&i>=e&&s.push(this.nodes[n])}else{for(var n=0,i=this.keys.length;n<i;n++){e<=this.keys[n]&&this.nodes[n].get(e,t,s)}this.nodes[n].get(e,t,s)}}}const months=[{name:"January",days:31,day_offset:0,day_offse_leapt:0},{name:"February",days:28,day_offset:31,day_offset_leap:31},{name:"March",days:31,day_offset:59,day_offset_leap:60},{name:"April",days:30,day_offset:90,day_offset_leap:91},{name:"May",days:31,day_offset:120,day_offset_leap:121},{name:"June",days:30,day_offset:151,day_offset_leap:152},{name:"July",days:31,day_offset:181,day_offset_leap:182},{name:"August",days:31,day_offset:212,day_offset_leap:213},{name:"September",days:30,day_offset:243,day_offset_leap:244},{name:"October",days:31,day_offset:273,day_offset_leap:274},{name:"November",days:30,day_offset:304,day_offset_leap:305},{name:"December",days:31,day_offset:33,day_offse_leapt:335}];var dow=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function GetDayStartAndEnd(e){var t={start:0,end:0};if(e instanceof Date||"number"==typeof e){var s=new Date(e);s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0),t.start=s.valueOf(),s.setDate(s.getDate()+1),s.setSeconds(-1),t.end=s.valueOf()}return t}function float24to12ModTime(e,t){var s=e>=12&&e<24;return((0|e)%12!=0?(0|e)%12:12)+":"+("0"+(e%1*60|0)).slice(-2)+(s?t?"PM":"pm":t?"AM":"am")}class Point2D extends Float64Array{constructor(e,t){if(super(2),"number"==typeof e)return this[0]=e,void(this[1]=t);e instanceof Array&&(this[0]=e[0],this[1]=e[1])}draw(e,t=1){e.beginPath(),e.moveTo(this.x*t,this.y*t),e.arc(this.x*t,this.y*t,.01*t,0,2*Math.PI),e.stroke()}get x(){return this[0]}set x(e){"number"==typeof e&&(this[0]=e)}get y(){return this[1]}set y(e){"number"==typeof e&&(this[1]=e)}}function posOnCurve(e,t,s,n){var i=1-e;return i*i*t+2*i*e*s+e*e*n}function splitCurve(e,t){var s=[],n=[];return function e(t,i){if(2==t.length)s.push(t[0],t[1]),n.push(t[0],t[1]);else{for(var r=[],o=0;o<t.length-2;o+=2)0==o&&s.push(t[o],t[o+1]),o==t.length-4&&n.push(t[o+2],t[o+3]),r.push((1-i)*t[o]+i*t[o+2]),r.push((1-i)*t[o+1]+i*t[o+3]);e(r,i)}}(e,t),{x:new QBezier(n),y:new QBezier(s)}}function curveIntersections(e,t,s){var n={a:1/0,b:1/0},i=e-2*t+s,r=2*(t-e),o=e;return 0==r||(Math.abs(i)<5e-11?n.a=-o/r:(n.a=(-r-Math.sqrt(r*r-4*i*o))/(2*i),n.b=(-r+Math.sqrt(r*r-4*i*o))/(2*i))),n}class QBezier{constructor(e,t,s,n,i,r){return this.x1=0,this.x2=0,this.x3=0,this.y1=0,this.y2=0,this.y3=0,"number"==typeof e?(this.x1=e,this.x2=s,this.x3=i,this.y1=t,this.y2=n,void(this.y3=r)):e instanceof QBezier?(this.x1=e.x1,this.x2=e.x2,this.x3=e.x3,this.y1=e.y1,this.y2=e.y2,void(this.y3=e.y3)):e instanceof Array?(this.x1=e[0],this.y1=e[1],this.x2=e[2],this.y2=e[3],this.x3=e[4],void(this.y3=e[5])):void 0}reverse(){return new QBezier(this.x3,this.y3,this.x2,this.y2,this.x1,this.y1)}point(e){return new Point2D(posOnCurve(e,this.x1,this.x2,this.x3),posOnCurve(e,this.y1,this.y2,this.y3))}tangent(e){var t={x:0,y:0},s=this.x2-this.x1,n=this.y2-this.y1,i=this.x3-this.x2,r=this.y3-this.y2;return t.x=(1-e)*s+e*i,t.y=(1-e)*n+e*r,t}toArray(){return[this.x1,this.y1,this.x2,this.y2,this.x3,this.y3]}split(e){return splitCurve(this.toArray(),e)}rootsX(){return this.roots(this.x1,this.x2,this.x3)}roots(e,t,s){this.toArray();var n=e-2*t+s,i=2*(t-e),r=e,o=2*r;console.log(n," c");var l=Math.sqrt(i*i-4*r*n);return console.log(l,i,o,s),[(-i+l)/o,(-i-l)/o]}rootsa(){var e=this.toArray(),t=e[1],s=e[3],n=e[5],i=e[0],r=e[2],o=2*(s-t),l=2*(r-i);return[-o/(-o+2*(n-s)),-l/(-l+2*(e[4]-r))]}boundingBox(){var e=curve[0],t=curve[1],s=curve[2],n=curve[3],i=curve[4],r=curve[5],o=getRootsClamped(curve);return{min:{x:Math.min(e,s,i,o.y[0]||1/0,o.x[0]||1/0),y:Math.min(t,n,r,o.y[1]||1/0,o.x[1]||1/0)},max:{x:Math.max(e,s,i,o.y[0]||-1/0,o.x[0]||-1/0),y:Math.max(t,n,r,o.y[1]||-1/0,o.x[1]||-1/0)}}}rotate(e,t){e=e/180*Math.PI;for(var s=this.toArray(),n=0;n<6;n+=2){var i=curve[n]-t.x,r=curve[n+1]-t.y;s[n]=i*Math.cos(e)-r*Math.sin(e)+t.x,s[n+1]=i*Math.sin(e)+r*Math.cos(e)+t.y}return new QBezier(s)}intersects(){return{x:curveIntersections(this.x1,this.x2,this.x3),y:curveIntersections(this.y1,this.y2,this.y3)}}add(e,t){if("number"==typeof e)return new QBezier(this.x1+e,this.y1+t,this.x2+e,this.y2+t,this.x3+e,this.y3+t)}}const sqrt=Math.sqrt,cos=Math.cos,acos=Math.acos,PI=Math.PI;function cuberoot(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function point(e,t,s,n,i){var r=1-e,o=r*r,l=e*e;return r*o*t+3*o*e*s+3*l*r*n+l*e*i}class CBezier extends Float64Array{constructor(e,t,s,n,i,r,o,l){return super(8),4==arguments.length?(this[0]=0,this[1]=0,this[2]=e,this[3]=t,this[4]=s,this[5]=n,this[6]=1,void(this[7]=1)):"number"==typeof e?(this[0]=e,this[1]=t,this[2]=s,this[3]=n,this[4]=i,this[5]=r,this[6]=o,void(this[7]=l)):e instanceof Array?(this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],void(this[7]=e[4])):void 0}get x1(){return this[0]}set x1(e){this[0]=e}get x2(){return this[2]}set x2(e){this[2]=e}get x3(){return this[4]}set x3(e){this[4]=e}get x4(){return this[6]}set x4(e){this[6]=e}get y1(){return this[1]}set y1(e){this[1]=e}get y2(){return this[3]}set y2(e){this[3]=e}get y3(){return this[5]}set y3(e){this[5]=e}get y4(){return this[7]}set y4(e){this[7]=e}add(e,t=0){return new CCurve(this[0]+e,this[1]+t,this[2]+e,this[3]+t,this[4]+e,this[5]+t,this[6]+e,this[7]+t)}valY(e){return point(e,this[1],this[3],this[5],this[7])}valX(e){return point(e,this[0],this[2],this[4],this[6])}point(e){return new Point2D(point(e,this[0],this[2],this[4],this[6]),point(e,this[1],this[3],this[5],this[7]))}roots(e,t,s,n){var i,r,o,l=3*t-e-3*s+n,a=(3*e-6*t+3*s)/l,h=(-3*e+3*t)/l,u=(3*h-a*a)/3,d=(2*a*a*a-9*a*h+27*(e/l))/27,c=d/2,p=c*c+(s=u/3)*s*s;if(p<0){var m=-u/3,_=sqrt(m*m*m),f=-d/(2*_),g=acos(f<-1?-1:f>1?1:f),y=2*cuberoot(_);return r=y*cos(g/3)-a/3,o=y*cos((g+2*PI)/3)-a/3,[y*cos((g+4*PI)/3)-a/3,r,o]}if(0===p)return[o=-(i=c<0?cuberoot(-c):-cuberoot(c))-a/3,r=2*i-a/3];var w=sqrt(p);return[r=(i=cuberoot(w-c))-cuberoot(w+c)-a/3]}rootsY(){return this.roots(this[1],this[3],this[5],this[7])}rootsX(){return this.roots(this[0],this[2],this[4],this[6])}getYatX(e){var t,s=this[0]-e,n=this[2]-e,i=3*n,r=3*s,o=3*(this[4]-e),l=1/(-s+i-o+(this[6]-e)),a=(r-6*n+o)*l,h=(-r+i)*l,u=1/3*(3*h-a*a),d=u*(1/3),c=1/27*(2*a*a*a-9*a*h+27*(s*l)),p=.5*c,m=p*p+d*d*d;if(m<0){var _=-u/3,f=sqrt(_*_*_),g=-c/(2*f),y=acos(g<-1?-1:g>1?1:g);t=2*cuberoot(f)*cos((y+4*PI)/3)-a/3}else if(0===m)t=-(p<0?cuberoot(-p):-cuberoot(p))-a*(1/3);else{var w=sqrt(m);t=cuberoot(w-p)-cuberoot(w+p)-a*(1/3)}return point(t,this[1],this[3],this[5],this[7])}draw(e,t=1){e.beginPath(),e.moveTo(this[0]*t,this[1]*t),e.bezierCurveTo(this[2]*t,this[3]*t,this[4]*t,this[5]*t,this[6]*t,this[7]*t),e.stroke()}}class TouchScroller{constructor(e,t=.02,s=0){this.origin_x=0,this.origin_y=0,this.velocity_x=0,this.velocity_y=0,this.GO=!0,this.drag=t>0?t:.02,this.element=e,!s instanceof Number&&(s=0);let n=0,i=(e,t,s,n=1)=>{let r=this.drag;e-=e*r*s*n,t-=t*r*s*n;let o=Math.max(Math.abs(t),Math.abs(t)),l=!(s>0&&o>.1&&this.GO);l||requestAnimationFrame(()=>{i(e,t,1)}),l=l&&0!=s;for(var a=0,h=this.listeners.length;a<h;a++)this.listeners[a]({dx:e,dy:t,end:l})&&(this.GO=!1)};this.event_b=(e=>{n=performance.now();var t=e.touches[s];this.velocity_x=this.origin_x-t.clientX,this.velocity_y=this.origin_y-t.clientY,this.origin_x=t.clientX,this.origin_y=t.clientY,i(this.velocity_x,this.velocity_y,0,0)}),this.event_c=(e=>{let t=performance.now()-n,s=Math.min(t/8.6666666,1/this.drag);this.GO=!0,i(this.velocity_x,this.velocity_y,s),this.velocity_x=0,this.velocity_y=0,window.removeEventListener("touchmove",this.event_b),window.removeEventListener("touchend",this.event_c)}),this.event_a=(e=>{if(!this.GO)return e.preventDefualt(),e.stopPropagation(),!1;n=performance.now(),this.GO=!1;var t=e.touches[s];t&&(this.origin_y=t.clientY,this.origin_x=t.clientX,window.addEventListener("touchmove",this.event_b),window.addEventListener("touchend",this.event_c))}),this.element.addEventListener("touchstart",this.event_a),this.listeners=[]}destructor(){this.listeners=null,this.element.removeEventListener("touchstart",this.event_a)}addEventListener(e){if(e instanceof Function){for(var t=0;t<this.listeners.length;t++)if(this.listeners[t]==e)return;this.listeners.push(e)}}removeEventListener(e){for(var t=0;t<this.listeners.length;t++)if(this.listeners[t]==e)return void this.listeners.splice(t,1)}}function Lex(e){return"string"!=typeof e?(console.warn("Cannot create a lexer on a non-string object!"),null):new Lexer(new Tokenizer(e))}Element.prototype.getWindowTop=function(){return this.offsetTop+(this.parentElement?this.parentElement.getWindowTop():0)},Element.prototype.getWindowLeft=function(){return this.offsetLeft+(this.parentElement?this.parentElement.getWindowLeft():0)},Element.prototype.getParentWindowTop=function(e=!1){return(e?this.offsetTop:0)+(this.parentElement?this.parentElement.getParentWindowTop(!0):0)},Element.prototype.getParentWindowLeft=function(e=!1){return(e?this.offsetLeft:0)+(this.parentElement?this.parentElement.getWindowLeft(!0):0)},Element.prototype.getStyle=function(e){return window.getComputedStyle(this,null).getPropertyValue(e)};var common=Object.freeze({Lex:Lex,Lexer:Lexer,Tokenizer:Tokenizer,months:months,dow:dow,QBezier:QBezier,CBezier:CBezier,TurnQueryIntoData:TurnQueryIntoData,TurnDataIntoQuery:TurnDataIntoQuery,GetDayStartAndEnd:GetDayStartAndEnd,TouchScroller:TouchScroller,float24to12ModTime:float24to12ModTime});let scape_date=new Date;scape_date.setHours(0),scape_date.setMilliseconds(0),scape_date.setSeconds(0),scape_date.setTime(0);let DATE=new class extends SchemaType{parse(e){if(!isNaN(e))return parseInt(e);let t=Lex(e),s=parseInt(t.token.text);if(s){scape_date.setHours(0),scape_date.setMilliseconds(0),scape_date.setSeconds(0),scape_date.setTime(0),t.next(),t.next();let e=parseInt(t.token.text)-1;t.next(),t.next();let n=parseInt(t.token.text);if(scape_date.setFullYear(s),scape_date.setDate(n),scape_date.setMonth(e),t.next(),t.token){let e=parseInt(t.token.text);t.next(),t.next();let s=parseInt(t.token.text);scape_date.setHours(e),scape_date.setMinutes(s)}return scape_date.valueOf()}return new Date(e).valueOf()}verify(e,t){t.valid=!0}filter(e,t){if(t.length>1)for(let s=0,n=t.length-1;s<n;s+=2){let n=t[s],i=t[s+1];if(n<=e&&e<=i)return!0}return!1}string(e){return new Date(e)+""}},TIME=new class extends SchemaType{parse(e){if(!isNaN(e))return parseInt(e);try{var t=parseInt(e.split(":")[0]),s=parseInt(e.split(":")[1].split(" ")[0]),n="pm"==e.split(":")[1].split(" ")[1].toLowerCase()}catch(e){t=0,s=0,n=0}return parseFloat(t+(n?12:0)+s/60)}verify(e,t){t.valid=!0}filter(e,t){return!0}string(e){return new Date(e)+""}},STRING=new class extends SchemaType{parse(e){return e+""}verify(e,t){t.valid=!0}filter(e,t){for(let s=0,n=t.length;s<n;s++)if(e.match(t[s]+""))return!0;return!1}},NUMBER=new class extends SchemaType{parse(e){return parseFloat(e)}verify(e,t){t.valid=!0,NaN!=e&&null!=e||(t.valid=!1,t.reason="Invalid number type.")}filter(e,t){for(let s=0,n=t.length;s<n;s++)if(e==t[s])return!0;return!1}},BOOL=new class extends SchemaType{parse(e){return!!e}verify(e,t){t.valid=!0,!e instanceof Boolean&&(t.valid=!1)}filter(e,t){return value instanceof BOOL}},schema={DATE:DATE,STRING:STRING,NUMBER:NUMBER,BOOL:BOOL,TIME:TIME};function CreateSchemedProperty(e,t,s){if(e.prototype[s])return;let n=`__${s}__`;Object.defineProperty(e.prototype,n,{writable:!0,configurable:!1,enumerable:!1,value:t.start_value||void 0}),Object.defineProperty(e.prototype,s,{configurable:!1,enumerable:!0,get:function(){return this[n]},set:function(e){let i={valid:!1},r=t.parse(e);t.verify(r,i),i.valid&&this[n]!=r&&(this[n]=r,this.scheduleUpdate(s))}})}function CreateMCSchemedProperty(e,t,s){t.schema;let n=t.container,i=`__${s}__`;Object.defineProperty(e.prototype,i,{enumerable:!1,writable:!0,value:null}),Object.defineProperty(e.prototype,s,{configurable:!1,enumerable:!0,get:function(){return this[i]||(this[i]=new n(t.schema)),this[i]},set:function(e){let r=this[i],o=null;if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return void console.log(e)}e instanceof Array?(o=e,r=new n(t.schema),this[i]=r,r.insert(o),this.scheduleUpdate(s)):e instanceof n&&(this[i]=e,console.log(s),this.scheduleUpdate(s))}})}function CreateModelProperty(e,t,s){t.schema;Object.defineProperty(e.prototype,s,{configurable:!1,enumerable:!0,get:function(){return Object.defineProperty(this,s,{configurable:!1,enumerable:!0,writable:!1,value:new t}),this[s]},set:function(e){}})}class Model extends ModelBase{constructor(e){super();let t=this.constructor.schema;if(!t)return new AnyModel(e);{let s=t.__FinalConstructor__,n=this.constructor;if(Object.defineProperty(n.prototype,"schema",{writable:!1,enumerable:!1,configurable:!1,value:t}),!s){for(let e in t){let s=t[e];s instanceof Array?s[0]&&s[0].container&&s[0].schema?CreateMCSchemedProperty(n,s[0],e):s[0]instanceof ModelContainer&&CreateModelProperty(n,s[0].constructor,e):s instanceof Model?CreateModelProperty(n,s[0].constructor,e):s instanceof SchemaType?CreateSchemedProperty(n,s,e):console.warn(`Could not create property ${e}.`)}return Object.seal(n),Object.defineProperty(t,"__FinalConstructor__",{writable:!1,enumerable:!1,configurable:!1,value:n}),new n(e)}}e&&this.add(e)}destructor(){this.schema=null;for(let e in this){let t=this[e];"object"==typeof t&&t.destructor instanceof Function?t.destructor():this[e]=null}super.destructor()}verify(e){let t={valid:!0,reason:""};var s=this.schema[e];return s&&(s instanceof Array||s instanceof Model||s.verify(this[e],t)),t}string(e){if(e){var t=this.schema[e];if(t)if(t instanceof Array)this[e].string();else{if(!(t instanceof Model))return t.string(this[e]);this[e].string()}}}add(e){for(let t in e)t in this&&(this[t]=e[t])}get(e){var t={};if(!e)return this;for(var s in e)s in this&&(t[s]=this[s]);return t}toJSON(){let e={},t=this.schema;for(let s in t){t[s];e[s]=this[s]}return e}}function AnyModelProxySet(e,t,s){return t in e&&e[t]==s||(e[t]=s,e.scheduleUpdate(t),!0)}class AnyModel extends ModelBase{constructor(e){if(super(),e)for(let t in e)this[t]=e[t];return new Proxy(this,{set:AnyModelProxySet})}destroy(){this.destructor()}destructor(){super.destructor()}add(e){for(var t in e)this[t]=e[t]}get(e){var t={};if(!e)return this;for(var s in e){let e=this[s];e&&(t[s]=e)}return t}remove(e){return{}}toJSON(){let e={};for(let t in this)"first_view"!=t&&"changed_values"!=t&&"____SCHEDULED____"!=t&&(e[t]=this[t]);return e}toJsonString(){return this.data+""}}class Controller{constructor(){this.model=null}destructor(){this.model=null}setModel(e){e instanceof Model&&(this.model=e)}set(e){this.model&&this.model.add(e)}}class Getter extends Controller{constructor(e,t){super(),this.url=e,this.FETCH_IN_PROGRESS=!1,this.rurl=t}destructor(){super.destructor()}get(e,t,s=!0){this.FETCH_IN_PROGRESS=!0;var n=(s?"https://":"http://")+window.location.host+this.url+(e?"?"+this.__process_url__(e):"");return(e=>fetch(n,{credentials:"same-origin",method:"GET"}).then(t=>{this.FETCH_IN_PROGRESS=!1,t.json().then(t=>{this.__process_response__(t,e)})}).catch(t=>{this.FETCH_IN_PROGRESS=!1,this.__rejected_reponse__(e),console.warn(`Unable to process response for request made to: ${this.url}. Response: ${t}. Error Received: ${t}`)}))(t)}parseJson(e){return e}__process_url__(e){var t="";for(var s in e)t+=`${s}=${e[s]}&`;return t.slice(0,-1)}__rejected_reponse__(e){e&&console.error("Unprocessed stored data in getter.")}__process_response__(e,t){if(this.rurl&&e){for(var s=this.rurl.split("<"),n=0;n<s.length&&e;n++)e=e[parseInt(s[n])?parseInt(s[n]):s[n]];console.log("json",e)}this.model?this.set(this.parseJson(e,t)):console.warn(`Unable to process response for request made to: ${this.url}. There is no model attached to this request controller!`)}}class Setter extends View{constructor(e){super(),this.url=e}destructor(){super.destructor()}set(e){var t="http://"+window.location.host+this.url+(e?"?"+this.__process_url__(e):"");fetch(t,{credentials:"same-origin",method:"POST"}).then(e=>{e.json().then(e=>{this.__process_response__(e)})}).catch(e=>{console.warn(`Unable to process response for request made to: ${this.url}. Response: ${e}. Error Received: ${e}`)})}parseJson(e){return e}__process_url__(e){var t="";for(var s in e)t+=`${s}=${e[s]}&`;return t.slice(0,-1)}__process_response__(e){this.model?(this.set(this.parseJson(e)),console.log(this.model)):console.warn(`Unable to process response for request made to: ${this.url}. There is no model attached to this request controller!`)}}class PageView{constructor(e,t){this.url=e,this.elements=[],this.finalizing_view=null,this.type="normal",this.element=t,this.element_backer=null,this.LOADED=!1}destructor(){for(var e=0;e<this.elements.length;e++){this.elements[e].destructor()}this.elements=null,this.element=null}unload(e){this.LOADED=!1;for(var t=0;t<this.elements.length;t++){let s=this.elements[t];s.getTransformTo(e),s.unloadComponents()}}transitionOut(e){let t=0;for(var s=0;s<this.elements.length;s++)t=Math.max(t,this.elements[s].transitionOut(e));return t}finalize(){if(!this.LOADED){for(var e=0;e<this.elements.length;e++){this.elements[e].finalize()}this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}load(e,t){this.LOADED=!0;for(var s=0;s<this.elements.length;s++){this.elements[s].loadComponents(t)}e.appendChild(this.element);this.element.style.opacity}transitionIn(e){"modal"==this.type&&(this.element_backer||(this.element_backer=document.createElement("div"),this.element_backer.classList.add("modal_backer"),this.element.appendChild(this.element_backer)),setTimeout(()=>{this.element.style.opacity=1},50));for(var t=0;t<this.elements.length;t++){let s=this.elements[t];s.parent=this,s.setTransformTo(e),s.transitionIn()}}getNamedElements(e){for(var t=0;t<this.elements.length;t++){this.elements[t].getNamedElements(e)}}compareComponents(){}setType(e){this.type=e||"normal"}}function setLinks(e,t){let s=e.getElementsByTagName("a");for(let e=0,n=s.length;e<n;e++){let n=s[e];n.dataset.ignore_link||n.origin===location.origin&&(n.onclick||(n.onclick=((e,t,s)=>n=>{n.preventDefault(),s(e,t)&&n.preventDefault()})(n.href,n,t)))}}class Color extends Float64Array{constructor(e,t,s,n=0){super(4),this.r=0,this.g=0,this.b=0,this.a=1,"string"==typeof e?this.fromString(e):(this.r=e,this.g=t,this.b=s,this.a=n)}get r(){return this[0]}set r(e){this[0]=e}get g(){return this[1]}set g(e){this[1]=e}get b(){return this[2]}set b(e){this[2]=e}get a(){return this[3]}set a(e){this[3]=e}set(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=null!=e.a?e.a:this.a}add(e){return new Color(e.r+this.r,e.g+this.g,e.b+this.b,e.a+this.a)}mult(e){return"number"==typeof e?new Color(this.r*e,this.g*e,this.b*e,this.a*e):new Color(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}sub(e){return new Color(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}toString(){return`rgba(${0|this.r}, ${0|this.g}, ${0|this.b}, ${this.a})`}fromString(e){let t,s,n,i,r=Lex(e);switch(r.token.text){case"rgb":r.next(),t=parseInt(r.next().text),r.next(),s=parseInt(r.next().text),r.next(),n=parseInt(r.next().text),this.set({r:t,g:s,b:n});break;case"rgba":r.next(),t=parseInt(r.next().text),r.next(),s=parseInt(r.next().text),r.next(),n=parseInt(r.next().text),r.next(),i=parseFloat(r.next().text),this.set({r:t,g:s,b:n,a:i});break;case"#":r.next().text;break;default:Color.colors[e]&&this.set(Color.colors[e]||new Color(255,255,255,1e-4))}}}Color.colors={transparent:new Color(255,255,255,1e-4),clear:new Color(255,255,255,1e-4),red:new Color(255,0,0),green:new Color(0,255,0),blue:new Color(0,0,255),Black:new Color(0,0,0),White:new Color(255,255,255),white:new Color(255,255,255),Red:new Color(255,0,0),Lime:new Color(0,255,0),Blue:new Color(0,0,255),Yellow:new Color(255,255,0),Cyan:new Color(0,255,255),Aqua:new Color(0,255,255),Magenta:new Color(255,0,255),Fuchsia:new Color(255,0,255),Silver:new Color(192,192,192),Gray:new Color(128,128,128),Maroon:new Color(128,0,0),Olive:new Color(128,128,0),Green:new Color(0,128,0),Purple:new Color(128,0,128),Teal:new Color(0,128,128),Navy:new Color(0,0,128),maroon:new Color(128,0,0),"dark red":new Color(139,0,0),brown:new Color(165,42,42),firebrick:new Color(178,34,34),crimson:new Color(220,20,60),red:new Color(255,0,0),tomato:new Color(255,99,71),coral:new Color(255,127,80),"indian red":new Color(205,92,92),"light coral":new Color(240,128,128),"dark salmon":new Color(233,150,122),salmon:new Color(250,128,114),"light salmon":new Color(255,160,122),"orange red":new Color(255,69,0),"dark orange":new Color(255,140,0),orange:new Color(255,165,0),gold:new Color(255,215,0),"dark golden rod":new Color(184,134,11),"golden rod":new Color(218,165,32),"pale golden rod":new Color(238,232,170),"dark khaki":new Color(189,183,107),khaki:new Color(240,230,140),olive:new Color(128,128,0),yellow:new Color(255,255,0),"yellow green":new Color(154,205,50),"dark olive green":new Color(85,107,47),"olive drab":new Color(107,142,35),"lawn green":new Color(124,252,0),"chart reuse":new Color(127,255,0),"green yellow":new Color(173,255,47),"dark green":new Color(0,100,0),green:new Color(0,128,0),"forest green":new Color(34,139,34),lime:new Color(0,255,0),"lime green":new Color(50,205,50),"light green":new Color(144,238,144),"pale green":new Color(152,251,152),"dark sea green":new Color(143,188,143),"medium spring green":new Color(0,250,154),"spring green":new Color(0,255,127),"sea green":new Color(46,139,87),"medium aqua marine":new Color(102,205,170),"medium sea green":new Color(60,179,113),"light sea green":new Color(32,178,170),"dark slate gray":new Color(47,79,79),teal:new Color(0,128,128),"dark cyan":new Color(0,139,139),aqua:new Color(0,255,255),cyan:new Color(0,255,255),"light cyan":new Color(224,255,255),"dark turquoise":new Color(0,206,209),turquoise:new Color(64,224,208),"medium turquoise":new Color(72,209,204),"pale turquoise":new Color(175,238,238),"aqua marine":new Color(127,255,212),"powder blue":new Color(176,224,230),"cadet blue":new Color(95,158,160),"steel blue":new Color(70,130,180),"corn flower blue":new Color(100,149,237),"deep sky blue":new Color(0,191,255),"dodger blue":new Color(30,144,255),"light blue":new Color(173,216,230),"sky blue":new Color(135,206,235),"light sky blue":new Color(135,206,250),"midnight blue":new Color(25,25,112),navy:new Color(0,0,128),"dark blue":new Color(0,0,139),"medium blue":new Color(0,0,205),blue:new Color(0,0,255),"royal blue":new Color(65,105,225),"blue violet":new Color(138,43,226),indigo:new Color(75,0,130),"dark slate blue":new Color(72,61,139),"slate blue":new Color(106,90,205),"medium slate blue":new Color(123,104,238),"medium purple":new Color(147,112,219),"dark magenta":new Color(139,0,139),"dark violet":new Color(148,0,211),"dark orchid":new Color(153,50,204),"medium orchid":new Color(186,85,211),purple:new Color(128,0,128),thistle:new Color(216,191,216),plum:new Color(221,160,221),violet:new Color(238,130,238),magenta:new Color(255,0,255),fuchsia:new Color(255,0,255),orchid:new Color(218,112,214),"medium violet red":new Color(199,21,133),"pale violet red":new Color(219,112,147),"deep pink":new Color(255,20,147),"hot pink":new Color(255,105,180),"light pink":new Color(255,182,193),pink:new Color(255,192,203),"antique white":new Color(250,235,215),beige:new Color(245,245,220),bisque:new Color(255,228,196),"blanched almond":new Color(255,235,205),wheat:new Color(245,222,179),"corn silk":new Color(255,248,220),"lemon chiffon":new Color(255,250,205),"light golden rod yellow":new Color(250,250,210),"light yellow":new Color(255,255,224),"saddle brown":new Color(139,69,19),sienna:new Color(160,82,45),chocolate:new Color(210,105,30),peru:new Color(205,133,63),"sandy brown":new Color(244,164,96),"burly wood":new Color(222,184,135),tan:new Color(210,180,140),"rosy brown":new Color(188,143,143),moccasin:new Color(255,228,181),"navajo white":new Color(255,222,173),"peach puff":new Color(255,218,185),"misty rose":new Color(255,228,225),"lavender blush":new Color(255,240,245),linen:new Color(250,240,230),"old lace":new Color(253,245,230),"papaya whip":new Color(255,239,213),"sea shell":new Color(255,245,238),"mint cream":new Color(245,255,250),"slate gray":new Color(112,128,144),"light slate gray":new Color(119,136,153),"light steel blue":new Color(176,196,222),lavender:new Color(230,230,250),"floral white":new Color(255,250,240),"alice blue":new Color(240,248,255),"ghost white":new Color(248,248,255),honeydew:new Color(240,255,240),ivory:new Color(255,255,240),azure:new Color(240,255,255),snow:new Color(255,250,250),black:new Color(0,0,0),"dim gray":new Color(105,105,105),"dim grey":new Color(105,105,105),gray:new Color(128,128,128),grey:new Color(128,128,128),"dark gray":new Color(169,169,169),"dark grey":new Color(169,169,169),silver:new Color(192,192,192),"light gray":new Color(211,211,211),"light grey":new Color(211,211,211),gainsboro:new Color(220,220,220),"white smoke":new Color(245,245,245),white:new Color(255,255,255)};var ease_out=new CBezier(.5,.2,0,1);requestAnimationFrame||(requestAnimationFrame=(e=>{setTimeout(e,1e3)}));class TT_From{constructor(e){var t=e.getBoundingClientRect();this.color=new Color(window.getComputedStyle(e,null).getPropertyValue("background-color")),this.height=parseFloat(window.getComputedStyle(e,null).getPropertyValue("height")),this.width=parseFloat(window.getComputedStyle(e,null).getPropertyValue("width")),this.height=t.height,this.width=t.width,this.left=parseFloat(t.left),this.top=parseFloat(t.top),this.element=e}destructor(){this.element=null,this.color=null}start(){this.element.style.opacity=0}end(){this.element.style.opacity=1}}class TT_To extends TT_From{constructor(e,t){super(e),this.from=t,this.res=e.style.top&&e.style.left,this.rt=e.style.top?e.style.top:null,this.rl=e.style.left?e.style.left:null;e.getParentWindowLeft();e.getParentWindowTop();var s=parseFloat(window.getComputedStyle(e,null).getPropertyValue("left")),n=parseFloat(window.getComputedStyle(e,null).getPropertyValue("top")),i=this.left-this.from.left;this.left=s,this.from.left=this.left-i;var r=this.top-this.from.top;this.top=n,this.from.top=this.top-r,this.time=21,this.s=0,this.color_o=window.getComputedStyle(e,null).getPropertyValue("background-color"),this.height_o=e.style.width,this.width_o=e.style.height,this.top_o=this.top,this.left_o=this.left,this.pos=window.getComputedStyle(e,null).getPropertyValue("position")}destructor(){this.end(),this.from=null,this.s=1/0,this.element=null,super.destructor()}start(){this.element.style.opacity=1,this.element.style.top=this.from.top+"px",this.element.style.left=this.from.left+"px",this.element.style.width=this.from.width+"px",this.element.style.height=this.from.height+"px"}step(){this.s++;var e=this.s/this.time;if(e>1)return!1;var t=ease_out.getYatX(e);return t>1&&(t=1),this.element.style.top=Math.round((this.top-this.from.top)*t+this.from.top)+"px",this.element.style.left=Math.round((this.left-this.from.left)*t+this.from.left)+"px",this.element.style.width=(this.width-this.from.width)*t+this.from.width+"px",this.element.style.height=(this.height-this.from.height)*t+this.from.height+"px",this.element.style.backgroundColor=this.color.sub(this.from.color).mult(t).add(this.from.color)+"",e<.9999995}end(){this.element.style.backgroundColor=null,this.element.style.height=this.height_o,this.element.style.width=this.width_o,this.element.style.top=this.rt,this.element.style.left=this.rl}}class TTPair{constructor(e,t){this.b=t instanceof TT_From?t:new TT_From(t),this.a=new TT_To(e,this.b),this.a.element.__TT__&&this.a.element.__TT__.destructor(),this.b.element.__TT__&&this.b.element.__TT__.destructor(),this.a.element.__TT__=this,this.b.element.__TT__=this,this.destroyed=!1,this.start()}destructor(){this.destroyed||(this.b.element&&(this.b.element.__TT__=null),this.a.element&&(this.a.element.__TT__=null),this.a.destructor(),this.destroyed=!0)}start(){this.b.start(),this.a.start()}step(){return this.a.step()}}const TransformRunner=new class{constructor(){this.pairs=[],this.____SCHEDULED____=!1}pushPair(e){this.pairs.push(e),Scheduler.queueUpdate(this)}update(e){let t=this.pairs;t.length>0&&Scheduler.queueUpdate(this);for(var s=0;s<t.length;s++){var n=t[s];n.step(e)||(n.destructor(),t.splice(s,1),s--)}}};function TransformTo(e,t,s){if(!t){return(e=>(t,s)=>{let n=new TTPair(t,e);TransformRunner.pushPair(n)})(new TT_From(e))}var n=new TTPair(t,e);TransformRunner.pushPair(n),n.start()}class AnimCore{constructor(){this.anim_group={},this.running_animations=[]}step(e){var t=this.running_animations.lenght;if(t>0)for(var s=0;s<t;s++){var n=this.running_animations[s];n&&!n.step(e)&&(n.destructor(),this.running_animations[s]=null)}}addBloc(e){}}var animation=Object.freeze({AnimCore:AnimCore,TransformTo:TransformTo,Color:Color});class Transitioneer{constructor(){}set(e,t){e.style.transition="opacity 0.5s",e.style.opacity=0}set_in(e,t,s=0){return e.style.transition=`opacity ${.8*s+.5}s`,e.style.opacity=1,.8}set_out(e,t,s=0){return e.style.opacity=0,.8}finalize_out(e){e.style.opacity=0}}let PresetTransitioneers={base:Transitioneer};class Rivet extends View{constructor(e=null,t=null,s={},n={}){super(),this.parent=e,this.element=t,this.children=[],this.data=n,this.named_elements=null,this.active=!1,this.export_val=null,this.DESTROYED=!1,this.transitioneer=null,n.trs&&(s.transitions&&s.transitions[n.trs]?this.transitioneer=new s.transitions[n.trs]:PresetTransitioneers[n.trs]&&(this.transitioneer=new PresetTransitioneers[n.trs]),this.transitioneer.set(this.element))}destructor(){if(this.DESTROYED=!0,this.LOADED){let e=this.transitionOut();for(let t=0,s=this.children.length;t<s;t++){let s=this.children[t];e=Math.max(e,s.transitionOut())}e>0&&setTimeout(()=>{this.destructor()},1e3*e+5)}else this.finalizeTransitionOut(),this.children.forEach(e=>e.destructor()),this.children.length=0,this.data=null,this.element&&this.element.parentElement&&this.element.parentElement.removeChild(this.element),this.element=null,super.destructor()}bubbleLink(e,t,s={}){if(this.parent){this.data.transition&&(s[this.data.transition]=this.element);for(var n=0,i=this.children.length;n<i;n++){let e=this.children[n];e!==t&&e.gatherTransitionElements(s)}this.parent.bubbleLink(e,this,s)}else history.pushState({},"ignored title",e),window.onpopstate()}getNamedElements(e){}gatherTransitionElements(e){this.data.transition&&!e[this.data.transition]&&(e[this.data.transition]=this.element),this.children.forEach(t=>{1==t.is&&t.gatherTransitionElements(e)})}copy(e,t){let s={};if(e||(e=this.element.cloneNode(!0)),this.children){s.element=e.children[this.element],s.children=new Array(this.children.length);for(var n=0,i=this.children.length;n<i;n++){let e=this.children[n];s.children[n]=e.copy(s.element)}}return s}handleUrlUpdate(e){}finalizeTransitionOut(){for(let e=0,t=this.children.length;e<t;e++)this.children[e].finalizeTransitionOut();this.transitioneer&&this.transitioneer.finalize_out(this.element),this.hide()}transitionIn(e=0){this.show();let t=0;this.LOADED=!0;for(let s=0,n=this.children.length;s<n;s++)t=Math.max(t,this.children[s].transitionIn(e));return this.transitioneer&&(t=Math.max(t,this.transitioneer.set_in(this.element,this.data,e))),t}transitionOut(e=0,t=!1){let s=0;this.LOADED=!1,this.transitioneer&&(s=Math.max(s,this.transitioneer.set_out(this.element,this.data,e)));for(let t=0,n=this.children.length;t<n;t++)s=Math.max(s,this.children[t].transitionOut(e));return t&&setTimeout(()=>{this.finalizeTransitionOut(),this.destructor()},1e3*s),s}updateDimensions(){for(var e=0;e<this.children.length;e++)this.children[e].updateDimensions()}__update__(e,t=!1){let s=this.update(e,t);for(let t=0,n=this.children.length;t<n;t++)this.children[t].__update__(s||e,!0)}load(e){for(var t=0;t<this.children.length;t++)this.children[t].load(e)}hide(){this.element&&(this.display=this.element.style.display,this.element.style.display="none")}show(){this.element&&"none"==this.element.style.display&&(this.element.style.display=this.display)}__updateExports__(e){this.data.export&&e[this.data.export]&&(this.export_val=e[this.data.export])}__getExports__(e){this.export_val&&(e[this.data.export]=this.export_val)}export(e=new AnyModel){if(this.parent&&this.parent.export){this.__getExports__(e);for(let t=0,s=this.children.length;t<s;t++)this.children[t].__getExports__(e);this.parent.export(e)}}import(e){this.model&&this.model.add(e),this.export(e)}updateExports(e){this.data.export&&e[this.data.export]&&(this.export=e[this.data.export])}add(e){this.model?(this.model.add(e),this.export(this.model)):this.parent&&this.parent.add&&this.parent.add(e)}}class BasicCase extends Rivet{constructor(e){super(null,e,{},{}),this.anchor=null,this.LOADED=!1,this.transitioneer=new Transitioneer,this.transitioneer.set(this.element)}getNamedElements(e){let t=this.element.children;for(var s=0;s<t.length;s++){let n=t[s];n.dataset.transition&&(e[n.dataset.transition]=n)}}}class FailedCase extends Rivet{constructor(e,t){var s=document.createElement("div");s.innerHTML=`<h3> This Wick component has failed!</h3> <h4>Error Message:</h4><p>${e.stack}</p><p>Please contact the website maintainers to address the problem.</p> <p>${t.error_contact}</p>`,super(null,s,{},{}),this.transitioneer=new Transitioneer,this.transitioneer.set(this.element)}}class CaseSkeleton{constructor(e,t,s,n=!1,i){this.element=e,this.Constructor=t,this.children=[],this.templates=[],this.dom_index=s,this.IS_NAMED_ELEMENT=n,this.data={},this.presets=i}flesh(e){let t={},s=this.____copy____(null,null,t);return s.load(e),s.named_elements=t,s}____copy____(e,t,s){let n;if(this.element){let t=this.element.cloneNode(!0);e&&(n=this.dom_index.getElement(e)).parentElement.replaceChild(t,n),e=t,n=t}else n=this.dom_index.getElement(e);this.IS_NAMED_ELEMENT&&(s[this.data.transition]=n);let i=new this.Constructor(t,n,this.presets,this.data);if(i.data=this.data,this.children.length>0){i.children=new Array(this.children.length);for(var r=0,o=this.children.length;r<o;r++){let t=this.children[r];i.children[r]=t.____copy____(e,i,s)}}if(this.templates.length>0){i.templates=new Array(this.templates.length);for(r=0,o=this.templates.length;r<o;r++){let t=this.templates[r];i.templates[r]=t.____copy____(e,i,s)}}return i}}class Cassette extends Rivet{constructor(e,t,s,n){super(e,t,s,n),this.prop=this.data.prop,this.width=0,this.height=0,this.top=0,this.left=0,this.lvl=0,this.is=1,this.data_cache=null,this.children=[],"A"==this.element.tagName&&this.processLink(this.element)}destructor(){"A"==this.element.tagName&&this.destroyLink(this.element),this.data_cache=null,super.destructor()}processLink(e,t){e.origin===location.origin&&(e.onclick||(e.onclick=((e,t,s)=>n=>{n.preventDefault(),s(e,t)&&n.preventDefault()})(e.href,e,(e,t)=>{let s=location.pathname==t.pathname,n=e.includes("#"),i="",r=Lex(e);for(;r.token;){if("{"==r.token.text){r.next();let t=r.token.text;r.next(),i+=this[t]||this.data_cache[t],"}"!=r.token.text&&console.warn(`incorrect value found in url ${e}`)}else i+=r.token.text;r.next()}return n&&this.export(),s||this.bubbleLink(i),!0})),e.onmouseover=(()=>{let t=e.href,s="",n=Lex(t);for(;n.token;){if("{"==n.token.text){n.next();let e=n.token.text;n.next(),s+=this[e]||this.data_cache[e],"}"!=n.token.text&&console.warn(`incorrect value found in url ${t}`)}else s+=n.token.text;n.next()}}))}destroyLink(e){e.onclick=null,e.onmouseover=null}update(e,t=!1){super.__updateExports__(e),e&&(this.prop?(this.element.innerHTML=e[this.prop],this[this.prop]=e[this.prop]):this.data_cache=e)}import(e){}load(e){this.children.forEach(t=>{t.load(e)}),this.data.model&&e.addView(this)}updateDimensions(){var e=this.element.getBoundingClientRect();this.width=e.width,this.height=e.height,this.top=e.top,this.left=e.left,super.updateDimensions()}}class Case extends Rivet{constructor(e=null,t,s,n){super(e,t,s,n),this.USE_SECURE=n.USE_HTTPS,this.named_elements={},this.template=null,this.prop=null,this.url=null,this.presets=n,this.receiver=null,this.query={},this.REQUESTING=!1,this.exports=null,this.filter_list=[],this.templates=[],this.is=0}destructor(){this.parent=null,this.receiver&&this.receiver.destructor();for(let e=0,t=this.templates.length;e<t;e++)this.templates[e].destructor();super.destructor()}load(e){if(this.data.url){let e=this.data.url.split(";");this.data.url=e[0];for(var t=1;t<e.length;t++){let s=e[t];switch(s[0]){case"p":this.url_parent_import=s.slice(1);break;case"q":this.url_query=s.slice(1);break;case"<":this.url_return=s.slice(1)}}}if(this.prop=this.data.prop,this.data.export&&(this.exports=this.data.export),this.model&&(e=this.model,this.model=null),e&&e instanceof Model&&(this.schema&&(e.constructor!=this.schema||(this.schema=null)),this.model=null),this.schema&&(e=new this.schema),e.addView(this),!this.model)throw new Error(`No Model could be found for Case constructor! Case schema "${this.data.schema}", "${this.presets.schemas[this.data.schema]}"; Case model "${this.data.model}", "${this.presets.models[this.data.model]}";`);this.data.url&&(this.receiver=new Getter(this.data.url,this.url_return),this.receiver.setModel(e),this.____request____());for(t=0;t<this.children.length;t++)this.children[t].load(this.model)}____request____(e){this.receiver.get(e,null,this.USE_SECURE).then(()=>{this.REQUESTING=!1}),this.REQUESTING=!0}export(e){this.updateSubs(this.children,e,!0),super.export(e)}updateSubs(e,t,s=!1){for(var n=0,i=e.length;n<i;n++){let i=e[n];if(i instanceof Case)i.update(t,!0);else{let e;if(s){if(i.data.import&&t[i.data.import]&&(e=i.update(t,!0))){this.updateSubs(i.children,e);continue}}else e=i.update(t,!0);this.updateSubs(i.children,e||t,s)}}}update(e,t=!1){if(this.updateDimensions(),!t){if(!e){if(!this.data_cache)return;e=this.data_cache}this.data_cache=e}if(this.updateSubs(this.children,e,t),this.templates.length>0)for(var s=0,n=this.templates.length;s<n;s++)this.templates[s].update(e,!0);this.REQUESTING=!1}handleUrlUpdate(e){let t=null;if(e&&this.data.import)if(t={},"null"==this.data.import)t=e.getClass(),console.log(t);else for(var s=this.data.import.split(";"),n=0;n<s.length;n++){let o=s[n].split(":"),l=o[0],a=o[1].split("=>");var i=a[0],r=a[1];"root"==l&&(l=null),t[r]=e.get(l,i)}if(e&&this.data.url){let t={};if(this.url_query)for(s=this.url_query.split(";"),n=0;n<s.length;n++){let o=s[n].split(":"),l=o[0],a=o[1].split("=>");i=a[0],r=a[1];"root"==l&&(l=null),t[r]=e.get(l,i)}this.____request____(t)}this.model||(this.model=new this.model_constructor,this.getter&&this.getter.setModel(this.model),this.model.addView(this)),t&&this.model.add(t)||this.update(this.model.get())}transitionIn(e=0){let t=0;for(let s=0,n=this.templates.length;s<n;s++)t=Math.max(t,this.templates[s].transitionIn(e));return t=Math.max(t,super.transitionIn(e)),this.updateDimensions(),t}transitionOut(e=0,t=!1){let s=0;for(let t=0,n=this.templates.length;t<n;t++)s=Math.max(s,this.templates[t].transitionOut(e));return s=Math.max(s,super.transitionOut(e,t))}finalizeTransitionOut(){for(let e=0,t=this.templates.length;e<t;e++)this.templates[e].finalizeTransitionOut();super.finalizeTransitionOut()}setActivating(){this.parent&&this.parent.setActivating()}getNamedElements(e){for(let t in this.named_elements)e[t]=this.named_elements[t]}}class CustomCase extends Case{constructor(e,t={},s={}){super(null,e,t,s)}}class Filter extends Cassette{constructor(e,t,s,n){super(e,t,s,n),e.filter_list.push(e=>this.filter(e)),this.element.addEventListener("input",()=>{this.parent.update()})}update(e){return!1}filter(e){return!1}}class Term extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.value=null}update(e){return!(!e[this.prop]||e[this.prop]==this.value)&&(this.value=e[this.prop],this.element.innerHTML=e[this.prop],this.parent.revise(),!0)}get term(){return this.element.innerHTML}set term(e){}}class CaseTemplate extends Case{constructor(e=null,t,s,n,i){if(super(e,t,s,n),this.cases=[],this.activeCases=[],this.case_constructors=[],this.filters=[],this.range=null,this.terms=[],this.prop_elements=[],i)for(var r=0,o=i.length;r<o;r++){let e=i[r];e.IS_CASE?this.case_constructors.push(e):e.Constructor==Term?this.terms.push(e.____copy____(t,this)):this.filters.push(e.____copy____(t,this))}let l=document.createElement("div");t.parentElement.replaceChild(l,t),this.element=l,this.prop=this.data.prop}filterUpdate(){let e=this.cases.slice();for(let t=this.filters.length,s=0;s<t;s++)e=this.filters[s].filter(e);for(var t=0;t<this.activeCases.length;t++)this.element.removeChild(this.activeCases[t].element);for(t=0;t<e.length;t++)this.element.appendChild(e[t].element);this.element.style.position=this.element.style.position;for(t=0;t<e.length;t++)e[t].transitionIn(t);this.activeCases=e}cull(e){if(0==e.length){for(let e=0,t=this.cases.length;e<t;e++)this.cases[e].destructor();this.cases.length=0}else{let s=new Map(e.map(e=>[e,!0]));var t=[];for(let e=0,t=this.cases.length;e<t;e++)s.has(this.cases[e].model)?s.set(this.cases[e].model,!1):(this.cases[e].destructor(),this.cases.splice(e,1),t--,e--);s.forEach((e,s,n)=>{e&&t.push(s)}),t.length>0&&this.added(t)}}load(e){}removed(e){for(let t=0;t<e.length;t++){let s=e[t];for(let e=0;e<this.cases.length;e++){let t=this.cases[e];if(t.model==s){this.cases.splice(e,1),t.dissolve();break}}}this.filterUpdate()}added(e){for(let t=0;t<e.length;t++){let s=this.case_constructors[0].flesh(e[t]);s.parent=this,this.cases.push(s)}this.filterUpdate()}revise(){this.cache&&this.update(this.cache)}getTerms(){let e=[];for(let t=0,s=this.terms.length;t<s;t++)e.push(this.terms[t].term);return 0==e.length?null:e}update(e,t=!1){console.log(e.toJson());let s=e.getChanged(this.prop);if(t){let t=!1;for(let s=0,n=this.terms.length;s<n;s++)this.terms[s].update(e)&&(t=!0);t&&this.model&&this.cull(this.get());for(let s=0,n=this.filters.length;s<n;s++)this.filters[s].update(e)&&(t=!0);t&&this.filterUpdate()}if(s&&(s instanceof ModelContainer||s.____self____)){this.cache=e;let t=s.get(this.getTerms(),null);t instanceof ModelContainer?(t.pin(),t.addView(this),this.cull(this.get())):t instanceof MCArray?this.cull(t):(t=e.____self____.data[this.prop])instanceof ModelContainer&&(t.addView(this),this.cull(this.get()))}}get(){if(!(this.model instanceof MultiIndexedContainer)){let e=this.model.source,t=this.getTerms();if(e){this.model.destructor();let s=e.get(t,null);s.pin(),s.addView(this)}return this.model.get(t)}if(this.data.index){let e=this.data.index,t={};return t[e]=this.getTerms(),this.model.get(t)[e]}return console.warn("No index value provided for MultiIndexedContainer!"),[]}transitionIn(e,t){let s=0;for(let n=0,i=this.templates.length;n<i;n++)s=Math.max(s,this.templates[n].transitionIn(e,t));return Math.max(s,super.transitionIn()),s}transitionOut(e=0,t=!1){for(let t=0,s=this.templates.length;t<s;t++)e=Math.max(e,this.templates[t].transitionOut());return Math.max(e,super.transitionOut(e,t)),e}}class FilterLimit extends Filter{constructor(e,t,s,n){super(e,t,s,n),e.filter_list.push(e=>this.filter(e)),this.element.addEventListener("input",()=>{this.parent.update()})}update(e){return e[this.data.prop]?(this.offset=parseInt(e[this.data.prop])||0,!0):!!e[this.data.import]&&(this.offset=parseInt(e[this.data.import])||0,!0)}filter(e){let t=e.length,s=Math.ceil(t/parseInt(this.data.value||20)),n=this.offset*(this.data.value||20)||0;this.export_val=s,this.data.export&&this.export();let i=[];for(let r=n;r<s+n&&r<t;r++)i.push(e[r]);return i}}let GLOBAL=()=>{let e=null;return{get linker(){return e},set linker(t){e||(e=t)}}};class Input extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.element.display="none",this.element.addEventListener("input",()=>{var e={};e[this.prop]=this.element.value,this.add(e)})}update(e){if(e[this.prop])switch(this.val=e[this.prop],this.element.type){case"date":this.element.value=new Date(parseInt(e[this.prop])).toISOString().split("T")[0];break;case"time":this.element.value=`${("00"+(0|e[this.prop])).slice(-2)}:${("00"+e[this.prop]%1*60).slice(-2)}:00.000`;break;case"text":this.element.value=null!=e[this.prop]?e[this.prop]:"";break;default:switch(this.element.classList[0]){case"modulo_time":var t=e[this.prop],s=t/12>1,n=t%1*60|0,i=(0|t)%12!=0?(0|t)%12:12;this.element.value=i+":"+("0"+n).slice(-2)+(s?" PM":" AM");break;default:this.element.value=null!=e[this.prop]?e[this.prop]:""}}}}class Form extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.submitted=!1,this.schema=null,t.addEventListener("submit",t=>(console.log(t.target,this,e),this.submitted||this.submit(),this.submitted=!0,t.preventDefault(),!1))}destructor(){}accepted(e){e.text().then(t=>{GLOBAL.linker.loadPage(GLOBAL.linker.loadNewPage(e.url,(new DOMParser).parseFromString(t,"text/html")),!1)})}rejected(e){e.text().then(t=>{GLOBAL.linker.loadPage(GLOBAL.linker.loadNewPage(e.url,(new DOMParser).parseFromString(t,"text/html")),!1)})}load(e){e&&(this.schema=e.schema),super.load(e)}update(e){}submit(){let e=this.element.action;var t=new FormData(this.element);if(this.schema)for(let e=0,s=this.children.length;e<s;e++){let s=this.children[e];if(s instanceof Input){let e=s.element.name,n=s.prop,i=this.schema[n];if(i&&n){let r=i.string(s.val);t.set(e,r),console.log(n,e,r,s.val)}}}fetch(e,{method:"post",credentials:"same-origin",body:t}).then(e=>{200!=e.status?this.rejected(e):this.accepted(e)}).catch(e=>{this.rejected(e)}),console.log("Wick Form Submitted",e,t)}}class Exporter extends Cassette{constructor(e,t,s,n){super(e,t,s,n),"A"==t.tagName&&t.addEventListener("click",()=>{this.event()})}event(){this.parent.export()}destructor(){this.element.removeEventListener("click",this.event),super.destructor()}}class ImportQuery extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.query=this.element.dataset.query}update(e){e[this.import_prop]&&(this.element.innerHTML=null!=e[this.import_prop]?e[this.import_prop]:"",this.query&&this.parent.query[this.query]!=e[this.import_prop]&&(this.parent.query[this.query]=e[this.import_prop],this.parent.request()))}}class DataEdit extends Cassette{constructor(e,t,s,n){super(e,t,s,n)}load(e){this.children.forEach(t=>{t.load(e)});let t=JSON.parse(this.element.value);t&&e.add(t),this.data.model&&e.addView(this)}update(e){}event(){this.parent.export()}destructor(){this.element.removeEventListener("click",this.event),super.destructor()}}class Exists extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.defualt=t.getStyle("display"),this.temp=document.createElement("span")}update(e){e&&(e[this.prop]?this.temp.parentElement&&this.temp.parentElement.replaceChild(this.element,this.temp):this.element.parentElement&&this.element.parentElement.replaceChild(this.temp,this.element))}}class NotExists extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.defualt=t.getStyle("display"),this.temp=document.createElement("span")}update(e){e&&(e[this.prop]?this.element.parentElement&&this.element.parentElement.replaceChild(this.temp,this.element):this.temp.parentElement&&this.temp.parentElement.replaceChild(this.element,this.temp))}}let day_of_week=dow,months$1=months;class EpochDay extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.TO_UPPERCASE="true"==this.data.uppercase,this.limit=parseInt(this.data.limit)>0?parseInt(this.data.limit):0}update(e){let t=e[this.prop],s=new Date(t);if(t&&s){let e=day_of_week[s.getDay()];e=this.limit>0?e.slice(0,this.limit):e,e=this.TO_UPPERCASE?e.toUpperCase():e,this.element.innerHTML=e}}}class EpochMonth extends Cassette{constructor(e,t,s,n){super(e,t,s,n),this.TO_UPPERCASE="true"==this.data.uppercase,this.limit=parseInt(this.data.limit)>0?parseInt(this.data.limit):0}update(e){let t=e[this.prop],s=new Date(t);if(t&&s){let e=months$1[s.getMonth()].name;e=this.limit>0?e.slice(0,this.limit):e,e=this.TO_UPPERCASE?e.toUpperCase():e,this.element.innerHTML=e}}}class EpochDate extends Cassette{constructor(e,t,s,n){super(e,t,s,n)}update(e){let t=e[this.prop],s=new Date(t);t&&s&&(this.element.innerHTML=s.getDate())}}class EpochYear extends Cassette{constructor(e,t,s,n){super(e,t,s,n)}update(e){let t=e[this.prop],s=new Date(t);t&&s&&(this.element.innerHTML=s.getFullYear())}}class EpochToDateTime extends Cassette{constructor(e,t,s,n){super(e,t,s,n)}update(e){let t=e[this.prop],s=new Date(t);t&&s&&(this.element.innerHTML=s)}}class EpochTime extends Cassette{constructor(e,t,s,n){super(e,t,s,n)}update(e){let t=e[this.prop],s=new Date(t);if(t&&s){let e=s.getHours()+s.getMinutes()/60;this.element.innerHTML=float24to12ModTime(e,!0)}}}let PresetCassettes={raw:Cassette,cassette:Cassette,form:Form,input:Input,export:Exporter,iquery:ImportQuery,edt:EpochToDateTime,etime:EpochTime,eday:EpochDay,edate:EpochDate,eyear:EpochYear,emonth:EpochMonth,exists:Exists,not_exists:NotExists,data_edit:DataEdit,term:Term,limit:FilterLimit};function ImportDataFromDataSet$$1(e,t,s){if(s)for(let n in t)e[n]=t[n],s.removeAttribute(`data-${n}`);else for(let s in t)e[s]=t[s]}class lvl{constructor(e=0,t=null){this.index=e,this.parent=t}getElement(e){if(this.parent){return this.parent.getElement(e).children[this.index]}return e.children[this.index]}}function CaseConstructor(e,t,s){let n;return e?e.skeleton?e.skeleton:(n=ComponentConstructor(null,document.importNode(e,!0),t,s)[0])?(e.skeleton=(e=>t=>e.flesh(t))(n),e.skeleton):null:null}function ComponentConstructor(e,t,s,n,i){var r=t.children;let o=[];var l=s.cassettes||{};if("TEMPLATE"==t.nodeName){let i;if((r=t.content.children).length<1)return(i=n.getElementById(t.classList[0]))&&"TEMPLATE"==t.nodeName?(i=i.cloneNode(!0),t.parentElement.replaceChild(i,t),ComponentConstructor(e,i,s,n)):[];{(i=document.importNode(t.content,!0)).attributes=t.attributes;let r=t.parentElement;if(r)return r.replaceChild(i,t),ComponentConstructor(e,i,s,n);t=i}}for(var a=null,h=0;h<r.length;h++){let d=r[h],c={},p=!1;ImportDataFromDataSet$$1(c,d.dataset),a&&(ImportDataFromDataSet$$1(c,a.dataset),a=null);let m=c.class;c.transition&&(p=!0);let _=null;switch(d.tagName){case"TEMPLATE":var u;if(a=d,d.content.children.length<1){if(!(u=n.getElementById(d.classList[0]))||"TEMPLATE"!=d.nodeName){a=null;continue}u=document.importNode(u.content,!0),d.parentElement.replaceChild(u,d)}else{(u=document.importNode(d.content,!0)).attributes=d.attributes;let e=d.parentElement;e&&e.replaceChild(u,d)}h--;continue;case"CASETEMPLATE":let r=new CaseSkeleton(null,null,new lvl(h,i),p,s);r.data=c;let f=ComponentConstructor(e,d,s,n);r.Constructor=(e=>(class extends CaseTemplate{constructor(t,s,n,i){super(t,s,n,i,e)}}))(f),e.templates.push(r);continue;case"CASE":if(_=m&&l[m]?l[m]:Case){(c.model||c.schema)&&(_=((e,t,n)=>(class extends e{constructor(e,i,r,o){super(e,i,r,o),this.model=s.models[t],this.schema=s.schemas[n]}}))(_,c.model,c.schema));let e=new CaseSkeleton(d,_,new lvl(h,i),p,s);ImportDataFromDataSet$$1(c,t.dataset),e.data=c,e.IS_CASE=!0,e.children=ComponentConstructor(e,d,s,n),o.push(e);continue}break;case"INPUT":if(_=l.input||PresetCassettes.input){let e=new CaseSkeleton(null,_,new lvl(h,i),p,s);e.data=c,e.children=ComponentConstructor(e,d,s,n,new lvl(h,i)),o.push(e)}else console.warn("Missing input Constructor in presets, unable to process form data!");break;case"FORM":let g;if(_=PresetCassettes.form,m&&(g=l[m])&&g.prototype instanceof Form?_=g:(l.form||PresetCassettes.form)&&(_=l.form||PresetCassettes.form),_){let e=new CaseSkeleton(null,_,new lvl(h,i),p,s);e.data=c,o.push(e),e.children=ComponentConstructor(e,d,s,n,new lvl(h,i));continue}console.warn("Missing form Constructor in presets, unable to process form data!");break;default:if(m&&(l[m]||PresetCassettes[m])&&(_=l[m]||PresetCassettes[m]),_){let e=new CaseSkeleton(null,_,new lvl(h,i),p,s);e.data=c,o.push(e),e.children=ComponentConstructor(e,d,s,n,new lvl(h,i));continue}}o=o.concat(ComponentConstructor(e,d,s,n,new lvl(h,i)))}return o}class Element$1{constructor(e){this.id=e.classList?e.classList[0]:e.id,this.components=[],this.bubbled_elements=null,this.wraps=[],this.element=e}unloadComponents(){for(var e=0;e<this.components.length;e++)this.components[e].LOADED=!1}transitionOut(){let e=0;for(var t=0;t<this.components.length;t++){let s=this.components[t];s.LOADED||(s.parent=null,e=Math.max(s.transitionOut(),e))}return e}finalize(){for(var e=0;e<this.components.length;e++){let t=this.components[e];!t.LOADED&&t.parentElement&&(t.finalizeTransitionOut(),this.wraps[e].removeChild(t.element)),t.LOADED=!1}}loadComponents(e){for(let t=0;t<this.components.length;t++){let s=this.components[t];s.parent=this,s.element.parentElement&&s.element.parentElement.removeChild(s.element),this.wraps[t].appendChild(s.element),s.handleUrlUpdate(e),this.components[t].LOADED=!0}}transitionIn(){let e=this.element.style.top;this.element.style.top=e;for(let e=0;e<this.components.length;e++){this.components[e].transitionIn()}}bubbleLink(e,t,s={}){this.bubbled_elements=s,history.pushState({},"ignored title",e),window.onpopstate()}getTransformTo(e){if(e){let t={};this.getNamedElements(t);for(let s in t)e[s]=TransformTo(t[s])}}setTransformTo(e){if(e){let t={};this.getNamedElements(t);for(let s in t){let n,i=e[s];(n=t[s])&&i&&i(n,!1)}}}getNamedElements(e){if(this.bubbled_elements){this.bubbled_elements;for(let t in this.bubbled_elements)e[t]=this.bubbled_elements[t];return}let t=this.element.children;for(var s=0;s<t.length;s++){let n=t[s];n.dataset.transition&&(e[n.dataset.transition]=n)}for(s=0;s<this.components.length;s++){this.components[s].getNamedElements(e)}}setComponents(e,t,s,n,i,r){var o=Array.prototype.map.call(this.element.getElementsByTagName("component"),e=>e);if(setLinks(this.element,(e,t)=>(history.pushState({},"ignored title",e),window.onpopstate(),!0)),o.length<1){let e=document.createElement("div");e.classList.add("comp_wrap"),e.innerHTML=this.element.innerHTML}for(var l=i.getElementsByTagName("template"),a=0;a<o.length;a++){let p=null,m=o[a];try{let o=document.createElement("div");o.classList.add("comp_wrap"),this.wraps.push(o),m.parentElement.replaceChild(o,m);var h,u=m.classList[0];if(u){if(e[u])p=e[u];else{if(h=s[u]){if(p=new h.constructor(l,n,m,i),h.model_name&&t[h.model_name]){var d=t[h.model_name];d.getter&&d.getter.get(),d.addView(p)}p.id=u,e[u]=p}else{var c=l[u];if(c)p=CaseConstructor(c,n,i)();else{let e=CaseConstructor(m,n,i);e||(e=CaseConstructor(m.children[0],n,i)),p=e?e():new BasicCase(m)}}p?e[u]=p:(console.warn("App Component not constructed"),p=new FailedCase)}p.handleUrlUpdate(r)}else p=new BasicCase(m)}catch(e){console.log(e),p=new FailedCase(e,n)}this.components.push(p)}}}let URL_HOST={wurl:null},URL={set:function(e,t,s){URL_HOST.wurl&&URL_HOST.wurl.set(e,t,s)},get:function(e,t){return URL_HOST.wurl?URL_HOST.wurl.set(e,t):null},goto:function(e,t){history.pushState({},"ignored title",`${e}${t?`?${TurnDataIntoQuery(t)}`:""}`),window.onpopstate()}};function getModalContainer(){let e=document.getElementsByTagName("modals")[0];if(!e){e=document.createElement("modals");var t=document.getElementsByTagName("app")[0];t?t.parentElement.insertBefore(e,t):document.body.appendChild(e)}return e}class Linker{constructor(e){if(this.pages={},this.components={},this.component_constructors={},this.models_constructors={},this.presets=e,this.current_url=null,this.current_query,this.current_view=null,this.finalizing_pages=[],GLOBAL.linker=this,e.static)for(let t in e.static){let s=e.static[t],n=0,i=0,r=0,o=0;(n=s.prototype.transitionIn&&s.prototype.transitionIn instanceof Function)&&(i=s.prototype.transitionOut&&s.prototype.transitionOut instanceof Function)&&(r=s.prototype.setModel&&s.prototype.setModel instanceof Function)&&(o=s.prototype.unsetModel&&s.prototype.unsetModel instanceof Function)?this.addStatic(t,s):console.warn(`Static component ${t} lacks correct component methods, \nHas transitionIn function:${n}\nHas transitionOut functon:${i}\nHas set model function:${r}\nHas unsetModel function:${o}`)}if(e.parser)for(let t in e.page_parser){e.page_parser[t]}e.schemas?e.schemas.any=AnyModel:e.schemas={any:AnyModel},e.models||(e.models={}),this.modal_stack=[],window.onpopstate=(()=>{this.parseURL(document.location)})}parseURL(e){let t=e.pathname,s=this.current_url==t,n=null,i=new WURL(e);if(this.current_url=t,n=this.pages[t])return s?(URL_HOST.wurl=i,n.transitionIn("modal"==n.type?getModalContainer():document.getElementsByTagName("app")[0],null,i,s)):this.loadPage(n,i,s);e&&fetch(e.href,{credentials:"same-origin",method:"GET"}).then(e=>{e.text().then(e=>{var n=(new DOMParser).parseFromString(e,"text/html");this.loadPage(this.loadNewPage(t,n,i),i,s)})}).catch(e=>{console.warn(`Unable to process response for request made to: ${this.url}. Response: ${e}. Error Received: ${e}`)})}finalizePages(){if(this.armed){this.armed;this.armed=null}for(var e=0,t=this.finalizing_pages.length;e<t;e++){this.finalizing_pages[e].finalize()}this.finalizing_pages.length=0}loadPage(e,t=new WURL(document.location),s){URL_HOST.wurl=t;let n=0,i=document.getElementsByTagName("app")[0],r={};if("modal"==e.type){if(s)return void e.transitionIn();let i=0;for(var o=0,l=this.modal_stack.length;o<l;o++){let t=this.modal_stack[o];if(0==i)t==e&&(i=o+1);else{let e=0;t.unload(),(e=t.transitionOut())?(n=Math.max(e,n),this.finalizing_pages.push(t)):t.finalize()}}i>0?(this.modal_stack.length=i,e.load(getModalContainer(),t),e.transitionIn()):(this.modal_stack.push(e),e.load(getModalContainer(),t),e.transitionIn())}else{for(o=0,l=this.modal_stack.length;o<l;o++){let e=this.modal_stack[o],t=0;e.unload(),(t=e.transitionOut())?(n=Math.max(t,n),this.finalizing_pages.push(e)):e.finalize()}if(this.modal_stack.length=0,this.current_view&&this.current_view!=e){this.current_view.unload(r),e.load(i,t);let s=this.current_view.transitionOut();window.requestAnimationFrame(()=>{e.transitionIn(r)}),n=Math.max(s,n),this.finalizing_pages.push(this.current_view)}else this.current_view||(e.load(i,t),window.requestAnimationFrame(()=>{e.transitionIn(r)}));this.current_view=e}setTimeout(()=>{this.finalizePages()},1e3*n+1)}addStatic(e,t,s){this.component_constructors[e]={constructor:t,model_name:s}}addModel(e,t){this.models_constructors[e]=t}loadNonWickPage(e){let t=document.createElement("iframe");t.src=e,t.classList.add("modal","comp_wrap");var s=new PageView(e,t);return s.type="modal",this.pages[e]=s,this.pages[e]}loadNewPage(e,t,s){let n=!1,i=t.getElementsByTagName("app");i.length>1&&console.warn(`Wick is designed to work with just one <app> element in a page. There are ${i.length} apps elements in ${url}. Wick will proceed with the first <app> element in the DOM. Unexpected behavior may occur.`);let r=i[0];if(!r)return console.trace("Page does not have an <app> element!"),this.loadNonWickPage(e);var o=document.createElement("apppage");o.innerHTML=r.innerHTML;var l=r.cloneNode(!0),a=document.getElementsByTagName("app")[0],h=new PageView(e,o);if(r){if("true"==r.dataset.modal){h.setType("modal");let e=document.createElement("modal");if(e.innerHTML=l.innerHTML,l.innerHTML="",l=e,t==document&&a){let e=document.createElement("app");document.body.replaceChild(e,a),a=e}}"true"==l.dataset.no_buffer&&(n=!0);for(var u=o.getElementsByTagName("element"),d=0;d<u.length;d++){let e,n=u[d],i=n.id;if("modal"!==h.type)e=new Element$1(n);else{let t=document.createElement("div");t.innerHTML=n.innerHTML,t.classList.add("ele_wrap"),e=new Element$1(n)}h.elements.push(e),this.components[i]||(this.components[i]={}),e.setComponents(this.components[i],this.models_constructors,this.component_constructors,this.presets,t,s)}document==t&&(a.innerHTML="");let i=h;return n||(this.pages[e]=i),i}}}let wick_vanity=" (  (                    )\n )\\))(   ' (          ( /(\n((_)()\\ )  )\\    (    )\\())\n_(())\\_)()((_)   )\\  ((_)\\\n\\ \\((_)/ / (_)  ((_) | |(_)\n \\ \\/\\/ /  | | / _|  | / /\n  \\_/\\_/   |_| \\__|  |_\\_\\\n",LINKER_LOADED=!1;function light(e){if(console.log(e),LINKER_LOADED)return;LINKER_LOADED=!0;let t=new Linker(e||{});window.addEventListener("load",()=>{t.loadPage(t.loadNewPage(document.location.pathname,document),new WURL(document.location),!1)}),console.log(`${wick_vanity}Copyright 2018 Anthony C Weathersby\nhttps://gitlab.com/anthonycweathersby/wick`)}export{URL,animation as Animation,ArrayModelContainer,BTreeModelContainer,MultiIndexedContainer,Controller,CustomCase,Rivet,CaseConstructor,Cassette,Form,Filter,common as Common,Getter,Linker,Model,ModelContainer,Setter,View,light,SchemaType,schema};
